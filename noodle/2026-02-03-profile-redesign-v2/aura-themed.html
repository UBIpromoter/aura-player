<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aura Visualization — Themed (Dark + Light)</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body, #root { height: 100%; margin: 0; background: #1a1a1a; }
    .phone-frame {
      width: 375px;
      height: 700px;
      border-radius: 40px;
      border: 8px solid #1a1a1a;
      box-shadow: 0 0 0 2px #333, 0 20px 60px rgba(0,0,0,0.5);
      overflow: hidden;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // ==================== PRODUCTION TOKENS ====================
    // From TOKENS.md - these are the only allowed colors
    const COLOR_HEX = {
      violet: '#8b5cf6',
      blue: '#3b82f6',
      teal: '#14b8a6',
      rose: '#f43f5e',
      pink: '#d946ef',
      emerald: '#10b981',
      amber: '#f59e0b',
      slate: '#64748b',
      indigo: '#6366f1',
      cyan: '#06b6d4',
    };

    // Theme helper (from production)
    const TH = (token, dark) => ({
      'text-primary': dark ? 'text-white' : 'text-gray-900',
      'text-secondary': dark ? 'text-gray-300' : 'text-gray-700',
      'text-muted': dark ? 'text-gray-400' : 'text-gray-500',
      'text-dim': dark ? 'text-gray-500' : 'text-gray-400',
      'bg-main': dark ? 'bg-gray-950' : 'bg-gray-50',
      'bg-card': dark ? 'bg-gray-900 border border-gray-800' : 'bg-white border border-gray-200',
      'bg-surface': dark ? 'bg-gray-900' : 'bg-white',
      'border-base': dark ? 'border-gray-800' : 'border-gray-200',
    })[token] || '';

    // ==================== AURA VISUALIZATION ====================
    // Now using production tokens + darkMode support
    const AuraVisualization = ({ stage, darkMode = true }) => {
      // Use production color tokens
      const violet = COLOR_HEX.violet;
      const blue = COLOR_HEX.blue;
      const emerald = COLOR_HEX.emerald;
      const pink = COLOR_HEX.pink;
      const cyan = COLOR_HEX.cyan;

      // Aura ellipses - zones of color for each stage
      const auraData = {
        1: [
          { cx: 100, cy: 70, rx: 80, ry: 60, color: violet, opacity: 0.85 },
          { cx: 100, cy: 130, rx: 70, ry: 50, color: blue, opacity: 0.7 },
        ],
        2: [
          { cx: 100, cy: 60, rx: 90, ry: 65, color: violet, opacity: 0.85 },
          { cx: 70, cy: 130, rx: 60, ry: 55, color: blue, opacity: 0.7 },
          { cx: 140, cy: 120, rx: 70, ry: 60, color: emerald, opacity: 0.8 },
        ],
        3: [
          { cx: 100, cy: 55, rx: 95, ry: 65, color: violet, opacity: 0.85 },
          { cx: 60, cy: 130, rx: 65, ry: 60, color: blue, opacity: 0.7 },
          { cx: 150, cy: 100, rx: 70, ry: 70, color: emerald, opacity: 0.8 },
          { cx: 100, cy: 150, rx: 80, ry: 55, color: pink, opacity: 0.8 },
        ],
        4: [
          { cx: 100, cy: 50, rx: 100, ry: 70, color: violet, opacity: 0.85 },
          { cx: 55, cy: 120, rx: 65, ry: 70, color: cyan, opacity: 0.8 },
          { cx: 150, cy: 90, rx: 70, ry: 75, color: emerald, opacity: 0.8 },
          { cx: 100, cy: 155, rx: 85, ry: 55, color: pink, opacity: 0.8 },
          { cx: 100, cy: 100, rx: 50, ry: 50, color: blue, opacity: 0.6 },
        ],
      }[stage];

      // Base neuron positions
      const baseNeurons = {
        1: [
          { x: 100, y: 95, r: 6, color: violet },
          { x: 75, y: 72, r: 5, color: violet },
          { x: 128, y: 85, r: 4, color: blue },
          { x: 88, y: 118, r: 5, color: blue },
          { x: 115, y: 108, r: 4, color: violet },
        ],
        2: [
          { x: 103, y: 98, r: 6, color: violet },
          { x: 68, y: 65, r: 5, color: violet },
          { x: 135, y: 78, r: 5, color: emerald },
          { x: 82, y: 135, r: 5, color: blue },
          { x: 55, y: 102, r: 4, color: blue },
          { x: 118, y: 58, r: 4, color: emerald },
          { x: 142, y: 118, r: 4, color: emerald },
        ],
        3: [
          { x: 100, y: 100, r: 6, color: violet },
          { x: 62, y: 58, r: 5, color: violet },
          { x: 142, y: 72, r: 5, color: emerald },
          { x: 155, y: 108, r: 4, color: emerald },
          { x: 45, y: 95, r: 5, color: blue },
          { x: 78, y: 145, r: 5, color: pink },
          { x: 128, y: 138, r: 5, color: pink },
          { x: 95, y: 68, r: 4, color: violet },
          { x: 68, y: 115, r: 4, color: blue },
          { x: 138, y: 95, r: 3, color: emerald },
        ],
        4: [
          { x: 100, y: 98, r: 6, color: violet },
          { x: 58, y: 52, r: 5, color: violet },
          { x: 138, y: 48, r: 4, color: violet },
          { x: 155, y: 85, r: 5, color: emerald },
          { x: 148, y: 125, r: 4, color: pink },
          { x: 42, y: 88, r: 5, color: cyan },
          { x: 52, y: 135, r: 5, color: cyan },
          { x: 115, y: 148, r: 5, color: pink },
          { x: 72, y: 148, r: 4, color: pink },
          { x: 85, y: 65, r: 4, color: violet },
          { x: 125, y: 72, r: 4, color: emerald },
          { x: 65, y: 105, r: 3, color: cyan },
          { x: 135, y: 105, r: 3, color: emerald },
        ],
      }[stage];

      // Connection indices
      const connectionIndices = {
        1: [[0,1], [0,2], [0,3], [0,4], [1,3], [2,4], [1,2]],
        2: [[0,1], [0,2], [0,3], [0,4], [0,5], [0,6], [1,4], [1,5], [2,5], [2,6], [3,4], [3,6]],
        3: [[0,1], [0,2], [0,3], [0,4], [0,5], [0,6], [0,7], [0,8], [0,9], [1,7], [2,7], [2,9], [3,9], [3,6], [4,8], [4,5], [5,6], [1,4]],
        4: [[0,1], [0,2], [0,3], [0,4], [0,5], [0,6], [0,7], [0,8], [0,9], [0,10], [0,11], [0,12], [1,9], [2,10], [3,10], [3,12], [4,12], [4,7], [5,11], [5,6], [6,8], [8,7], [1,5], [2,3]],
      }[stage];

      // Animation
      const [time, setTime] = useState(0);
      const animRef = useRef();

      useEffect(() => {
        const animate = () => {
          setTime(t => t + 0.02);
          animRef.current = requestAnimationFrame(animate);
        };
        animRef.current = requestAnimationFrame(animate);
        return () => cancelAnimationFrame(animRef.current);
      }, []);

      const animatedNeurons = baseNeurons.map((n, i) => {
        const speed = 0.5 + (i % 3) * 0.3;
        const amp = 1.5 + (i % 4) * 0.5;
        const phaseX = i * 1.3;
        const phaseY = i * 0.9 + 0.5;
        return {
          ...n,
          x: n.x + Math.sin(time * speed + phaseX) * amp,
          y: n.y + Math.cos(time * speed * 0.8 + phaseY) * amp,
        };
      });

      const sizes = { 1: 180, 2: 200, 3: 220, 4: 240 };
      const size = sizes[stage];

      // Line color adapts to theme
      const lineColor = darkMode ? 'rgba(255,255,255,0.35)' : 'rgba(0,0,0,0.2)';

      return (
        <div className="flex items-center justify-center" style={{ width: size, height: size * 1.1, margin: '0 auto' }}>
          <svg width={size} height={size * 1.1} viewBox="0 0 200 220" style={{ overflow: 'visible' }}>
            <defs>
              <filter id={`blur-${stage}-${darkMode}`} x="-100%" y="-100%" width="300%" height="300%">
                <feGaussianBlur in="SourceGraphic" stdDeviation={stage === 4 ? 22 : 18} />
              </filter>
            </defs>

            {/* Organic aura glow */}
            <g filter={`url(#blur-${stage}-${darkMode})`}>
              {auraData.map((e, i) => (
                <ellipse key={i} cx={e.cx} cy={e.cy} rx={e.rx} ry={e.ry} fill={e.color} opacity={darkMode ? e.opacity : e.opacity * 0.7} />
              ))}
            </g>

            {/* Connection lines */}
            <g stroke={lineColor} strokeWidth="1">
              {connectionIndices.map(([from, to], i) => (
                <line
                  key={i}
                  x1={animatedNeurons[from].x}
                  y1={animatedNeurons[from].y}
                  x2={animatedNeurons[to].x}
                  y2={animatedNeurons[to].y}
                />
              ))}
            </g>

            {/* Neurons with glow */}
            {animatedNeurons.map((n, i) => (
              <g key={i}>
                <circle cx={n.x} cy={n.y} r={n.r * 2} fill={n.color} opacity="0.3" filter={`url(#blur-${stage}-${darkMode})`} />
                <circle cx={n.x} cy={n.y} r={n.r} fill={n.color} />
              </g>
            ))}
          </svg>
        </div>
      );
    };

    // ==================== HINT CARD ====================
    // Themed version using production patterns
    const HintCard = ({ color, text, subtitle, darkMode }) => {
      const dotColor = COLOR_HEX[color] || COLOR_HEX.violet;
      return (
        <div className={`rounded-xl p-3 flex items-start gap-3 ${darkMode ? 'bg-gray-900/60 border border-gray-800' : 'bg-white border border-gray-200 shadow-sm'}`}>
          <div className="w-2.5 h-2.5 rounded-full mt-1 flex-shrink-0" style={{ backgroundColor: dotColor }} />
          <div>
            <p className={`text-sm font-medium ${TH('text-primary', darkMode)}`}>{text}</p>
            {subtitle && <p className={`text-xs mt-0.5 ${TH('text-dim', darkMode)}`}>{subtitle}</p>}
          </div>
        </div>
      );
    };

    // ==================== DEMO FRAME ====================
    const DemoFrame = ({ darkMode, stage }) => {
      const hints = [
        { color: 'violet', text: 'Strong curiosity', subtitle: 'You seek out new ideas and experiences' },
        { color: 'emerald', text: 'Natural warmth', subtitle: 'Others feel at ease around you' },
        { color: 'pink', text: 'Steady under pressure', subtitle: 'You stay calm when things get intense' },
      ].slice(0, Math.min(stage, 3));

      return (
        <div className={`phone-frame flex flex-col ${darkMode ? 'bg-gray-950' : 'bg-gray-50'}`}>
          {/* Header */}
          <div className={`h-12 flex items-center justify-between px-4 border-b ${TH('border-base', darkMode)}`}>
            <span className={`text-sm font-medium ${TH('text-primary', darkMode)}`}>Your Aura</span>
            <span className={`text-xs ${TH('text-dim', darkMode)}`}>{darkMode ? 'Dark' : 'Light'}</span>
          </div>

          {/* Content */}
          <div className="flex-1 flex flex-col p-4 overflow-auto">
            {/* Hints */}
            <div className="space-y-2 mb-4">
              {hints.map((h, i) => (
                <HintCard key={i} {...h} darkMode={darkMode} />
              ))}
            </div>

            {/* Aura */}
            <div className="flex-1 flex flex-col items-center justify-center">
              <AuraVisualization stage={stage} darkMode={darkMode} />
              <p className={`text-xs mt-2 ${TH('text-dim', darkMode)}`}>
                {stage < 4 ? 'Your pattern is forming...' : 'Your unique pattern'}
              </p>
            </div>

            {/* CTA - slightly softer but still a clear action */}
            <button className={`w-full py-3 rounded-xl font-medium mt-4 ${
              darkMode
                ? 'bg-violet-500/90 text-white hover:bg-violet-500'
                : 'bg-violet-400 text-white hover:bg-violet-500'
            }`}>
              {stage < 4 ? 'Continue' : 'View Full Profile'}
            </button>
          </div>
        </div>
      );
    };

    // ==================== MAIN APP ====================
    function App() {
      const [stage, setStage] = useState(4);

      return (
        <div className="h-full flex flex-col items-center justify-center gap-6 p-4">
          {/* Stage selector */}
          <div className="flex gap-2">
            {[1, 2, 3, 4].map(s => (
              <button
                key={s}
                onClick={() => setStage(s)}
                className={`px-4 py-2 rounded-lg text-sm font-medium ${stage === s ? 'bg-violet-600 text-white' : 'bg-gray-800 text-gray-400'}`}
              >
                Stage {s}
              </button>
            ))}
          </div>

          {/* Side by side comparison */}
          <div className="flex gap-6">
            <DemoFrame darkMode={true} stage={stage} />
            <DemoFrame darkMode={false} stage={stage} />
          </div>

          <p className="text-gray-500 text-sm">Dark mode (left) vs Light mode (right) — Using production TOKENS</p>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
