<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aura ‚Äî Glass Dashboard Atlas</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --sat: 0px; --sar: 0px; --sab: 0px; --sal: 0px; }
    html, body, #root { margin: 0; padding: 0; height: 100%; width: 100%; }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    .question-text { font-size: clamp(20px, 6vw, 28px); line-height: 1.35; text-wrap: balance; }
    @keyframes fadeSlideIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    @keyframes shimmer-pulse { 0%, 100% { opacity: 0.4; } 50% { opacity: 0.8; } }
    @keyframes sweepFill { from { width: 0%; } to { width: 100%; } }
    @keyframes celebrateGlow { 0% { transform: scale(0.8); opacity: 0; } 50% { transform: scale(1.2); opacity: 1; } 100% { transform: scale(1); opacity: 1; } }
    .celebrate-glow { animation: celebrateGlow 0.6s ease-out forwards; }
    .btn-feedback { transition: transform 0.1s ease, filter 0.1s ease !important; }
    .btn-feedback:hover { filter: brightness(1.15) !important; }
    .btn-feedback:active { transform: scale(0.96) !important; filter: brightness(0.92) !important; }
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

    /* ===== GLASS DASHBOARD STYLES ===== */
    body.dark-mode { background: linear-gradient(135deg, #0a0e1a 0%, #111a2e 40%, #0d1526 70%, #0a0f1e 100%); }
    body.light-mode { background: linear-gradient(135deg, #e8edf5 0%, #dfe6f2 40%, #edf1f9 70%, #f3f6fc 100%); }

    /* Dark mode glass */
    .dark .glass-panel {
      background: rgba(255,255,255,0.04);
      backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
    }
    /* Light mode frosted glass ‚Äî daylight frost effect */
    .light .glass-panel {
      background: rgba(255,255,255,0.55);
      backdrop-filter: blur(24px) saturate(1.4); -webkit-backdrop-filter: blur(24px) saturate(1.4);
      border: 1px solid rgba(255,255,255,0.7);
      border-radius: 16px;
      box-shadow: 0 2px 16px rgba(0,0,0,0.04), inset 0 1px 0 rgba(255,255,255,0.8);
    }

    .glass-search:focus-within { border-color: rgba(139,92,246,0.4); box-shadow: 0 0 20px rgba(139,92,246,0.1); }

    .glass-card {
      position: relative; cursor: pointer; border-radius: 20px; overflow: visible;
      transition: transform 0.25s cubic-bezier(0.4,0,0.2,1), box-shadow 0.25s ease;
    }
    .glass-card:hover { transform: translateY(-6px) scale(1.02); }

    @keyframes glassExpand {
      from { opacity: 0; transform: scale(0.92) translateY(10px); }
      to { opacity: 1; transform: scale(1) translateY(0); }
    }
    @keyframes glassFadeIn { from { opacity: 0; } to { opacity: 1; } }
    .glass-modal-enter { animation: glassExpand 0.3s cubic-bezier(0.16,1,0.3,1) forwards; }
    .glass-overlay-enter { animation: glassFadeIn 0.2s ease forwards; }

    /* Shine card system */
    .shine-card { position: relative; }
    .shine-card::before {
      content: ''; position: absolute; inset: -1px; border-radius: inherit;
      background: linear-gradient(180deg, var(--accent-bright, rgba(255,255,255,0.5)) 0%, var(--accent-color, rgba(255,255,255,0.2)) 5%, transparent 15%, transparent 100%);
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor; mask-composite: exclude;
      padding: 2px; pointer-events: none; z-index: 20; opacity: 0; transition: opacity 0.3s ease;
    }
    .shine-card:hover::before { opacity: 1; animation: shimmer-pulse 3s ease-in-out infinite; }
    .shine-blue { --accent-color: rgba(59, 130, 246, 0.3); --accent-bright: rgba(147, 197, 253, 0.6); }
    .shine-amber { --accent-color: rgba(251, 191, 36, 0.2); --accent-bright: rgba(253, 224, 71, 0.45); }
    .shine-violet { --accent-color: rgba(139, 92, 246, 0.25); --accent-bright: rgba(196, 181, 253, 0.55); }
    .shine-teal { --accent-color: rgba(45, 212, 191, 0.2); --accent-bright: rgba(153, 246, 228, 0.5); }
    .shine-emerald { --accent-color: rgba(16, 185, 129, 0.25); --accent-bright: rgba(110, 231, 183, 0.55); }
    .shine-rose { --accent-color: rgba(244, 63, 94, 0.25); --accent-bright: rgba(251, 113, 133, 0.55); }
    .shine-gray { --accent-color: rgba(156, 163, 175, 0.2); --accent-bright: rgba(209, 213, 219, 0.45); }

    .glow-amber { box-shadow: 0 0 15px rgba(251, 191, 36, 0.12), 0 0 35px rgba(251, 191, 36, 0.08); }
    .glow-violet { box-shadow: 0 0 18px rgba(139, 92, 246, 0.2), 0 0 40px rgba(139, 92, 246, 0.12); }
    .glow-teal { box-shadow: 0 0 18px rgba(45, 212, 191, 0.16), 0 0 40px rgba(45, 212, 191, 0.1); }
    .glow-blue { box-shadow: 0 0 20px rgba(59, 130, 246, 0.2), 0 0 45px rgba(59, 130, 246, 0.12); }
    .glow-emerald { box-shadow: 0 0 18px rgba(16, 185, 129, 0.16), 0 0 40px rgba(16, 185, 129, 0.1); }
    .glow-rose { box-shadow: 0 0 18px rgba(244, 63, 94, 0.16), 0 0 40px rgba(244, 63, 94, 0.1); }

    .starry-bg { background: linear-gradient(135deg, rgba(30, 20, 10, 0.9) 0%, rgba(50, 30, 15, 0.8) 100%); position: relative; }
    .starry-bg::before {
      content: ''; position: absolute; inset: 0;
      background-image: radial-gradient(1px 1px at 20px 30px, white, transparent),
        radial-gradient(1px 1px at 40px 70px, rgba(255,255,255,0.8), transparent),
        radial-gradient(1px 1px at 90px 40px, rgba(255,255,255,0.7), transparent),
        radial-gradient(1px 1px at 130px 55px, white, transparent),
        radial-gradient(1.5px 1.5px at 200px 50px, rgba(255,255,255,0.9), transparent);
      opacity: 0.7; border-radius: inherit;
    }
  </style>
</head>
<body class="bg-gray-950">
  <div id="root"></div>
  <script>
const _warn = console.warn;
console.warn = (...args) => { if (typeof args[0] === 'string' && args[0].includes('cdn.tailwindcss.com')) return; _warn.apply(console, args); };
  </script>
  <script type="text/babel">
const { useState, useCallback, useEffect, useRef, useMemo } = React;

// ==================== SHARED TOKENS ====================
const COLOR_HEX = {
  violet:  { base: '#8b5cf6', light: '#a78bfa', rgb: '139, 92, 246' },
  blue:    { base: '#3b82f6', light: '#60a5fa', rgb: '59, 130, 246' },
  teal:    { base: '#14b8a6', light: '#2dd4bf', rgb: '20, 184, 166' },
  rose:    { base: '#f43f5e', light: '#fb7185', rgb: '244, 63, 94' },
  pink:    { base: '#d946ef', light: '#e879f9', rgb: '217, 70, 239' },
  emerald: { base: '#10b981', light: '#34d399', rgb: '16, 185, 129' },
  slate:   { base: '#64748b', light: '#94a3b8', rgb: '100, 116, 139' },
  amber:   { base: '#f59e0b', light: '#fbbf24', rgb: '245, 158, 11' },
  indigo:  { base: '#6366f1', light: '#818cf8', rgb: '99, 102, 241' },
  cyan:    { base: '#06b6d4', light: '#67e8f9', rgb: '6, 182, 212' },
  gray:    { base: '#6b7280', light: '#9ca3af', rgb: '107, 114, 128' },
};

const PROGRESS_GRADIENTS = Object.fromEntries(
  Object.entries(COLOR_HEX).map(([c, hex]) => [c, { from: hex.base, to: hex.light }])
);

const TH = (token, dark) => ({
  'text-primary': dark ? 'text-white' : 'text-gray-900',
  'text-secondary': dark ? 'text-gray-300' : 'text-gray-700',
  'text-muted': dark ? 'text-gray-400' : 'text-gray-600',
  'text-subtle': dark ? 'text-gray-500' : 'text-gray-400',
  'text-faint': dark ? 'text-gray-600' : 'text-gray-400',
  'bg-main': dark ? 'bg-gray-950' : 'bg-gray-50',
  'bg-card': dark ? 'bg-gray-900 border border-gray-800' : 'bg-white border border-gray-200',
  'bg-card-shine': dark ? 'bg-gray-900 shine-card shine-gray' : 'bg-white border border-gray-200',
  'bg-overlay': dark ? 'bg-gray-900/50' : 'bg-gray-100',
  'border-base': dark ? 'border-gray-800' : 'border-gray-200',
  'text-violet': dark ? 'text-violet-400' : 'text-violet-600',
  'text-emerald': dark ? 'text-emerald-400' : 'text-emerald-600',
  'text-rose': dark ? 'text-rose-400' : 'text-rose-600',
  'text-sky': dark ? 'text-sky-300' : 'text-sky-500',
  'text-dim': dark ? 'text-gray-400' : 'text-gray-500',
  'text-bright': dark ? 'text-gray-100' : 'text-gray-900',
  'chip-violet': dark ? 'bg-violet-900/30 text-violet-400' : 'bg-violet-100 text-violet-700',
  'bg-surface': dark ? 'bg-gray-900' : 'bg-white',
}[token] || '');

// ==================== PHONE FRAME with Dynamic Island ====================
const PhoneChrome = ({ children, darkMode, scale = 1, bgColor }) => {
  const w = 393 * scale;
  const h = 852 * scale;
  const br = 44 * scale;
  // Dynamic island dimensions
  const diW = 126 * scale;
  const diH = 37 * scale;
  const diTop = 12 * scale;
  const diRadius = 20 * scale;
  // Status bar area blends with screen bg
  const statusH = 54 * scale;

  return (
    <div style={{
      width: w, height: h, borderRadius: br, overflow: 'hidden',
      position: 'relative', flexShrink: 0,
      backgroundColor: bgColor || (darkMode ? '#030712' : '#f9fafb'),
    }}>
      {/* Dynamic Island pill - always dark */}
      <div style={{
        position: 'absolute', top: diTop, left: '50%', transform: 'translateX(-50%)',
        width: diW, height: diH, background: '#000', borderRadius: diRadius,
        zIndex: 30,
      }}>
        {/* Camera dot inside island */}
        <div style={{
          position: 'absolute', right: 18 * scale, top: '50%', transform: 'translateY(-50%)',
          width: 10 * scale, height: 10 * scale, borderRadius: '50%',
          background: 'radial-gradient(circle, #1a1a2e 0%, #0a0a15 60%, #000 100%)',
          boxShadow: 'inset 0 0 2px rgba(255,255,255,0.1)',
        }} />
      </div>
      {/* Status bar - transparent, sits over content for blending */}
      <div style={{
        height: statusH, padding: `0 ${32 * scale}px ${8 * scale}px`,
        display: 'flex', alignItems: 'flex-end', justifyContent: 'space-between',
        fontSize: 14 * scale, fontWeight: 600, zIndex: 20, position: 'relative',
        color: darkMode ? '#fff' : '#1a1a1a',
      }}>
        <span>9:41</span>
        <div style={{ display: 'flex', gap: 5 * scale, alignItems: 'center' }}>
          {/* Signal bars */}
          <svg width={16 * scale} height={12 * scale} viewBox="0 0 16 12" fill="none">
            <rect x="0" y="8" width="3" height="4" rx="0.5" fill={darkMode ? '#fff' : '#1a1a1a'} />
            <rect x="4.5" y="5" width="3" height="7" rx="0.5" fill={darkMode ? '#fff' : '#1a1a1a'} />
            <rect x="9" y="2" width="3" height="10" rx="0.5" fill={darkMode ? '#fff' : '#1a1a1a'} />
            <rect x="13" y="0" width="3" height="12" rx="0.5" fill={darkMode ? 'rgba(255,255,255,0.3)' : 'rgba(0,0,0,0.2)'} />
          </svg>
          {/* Wifi */}
          <svg width={15 * scale} height={12 * scale} viewBox="0 0 15 12" fill="none">
            <path d="M7.5 10.5a1.25 1.25 0 100 2.5 1.25 1.25 0 000-2.5z" fill={darkMode ? '#fff' : '#1a1a1a'} transform="translate(0,-1.5)" />
            <path d="M4.5 9c1.7-1.7 4.3-1.7 6 0" stroke={darkMode ? '#fff' : '#1a1a1a'} strokeWidth="1.3" strokeLinecap="round" transform="translate(0,-1.5)" />
            <path d="M2 6.5c3-3 8-3 11 0" stroke={darkMode ? '#fff' : '#1a1a1a'} strokeWidth="1.3" strokeLinecap="round" transform="translate(0,-1.5)" />
          </svg>
          {/* Battery */}
          <svg width={25 * scale} height={12 * scale} viewBox="0 0 25 12" fill="none">
            <rect x="0.5" y="0.5" width="21" height="11" rx="2" stroke={darkMode ? 'rgba(255,255,255,0.35)' : 'rgba(0,0,0,0.25)'} strokeWidth="1" />
            <rect x="22.5" y="3.5" width="2" height="5" rx="1" fill={darkMode ? 'rgba(255,255,255,0.2)' : 'rgba(0,0,0,0.15)'} />
            <rect x="2" y="2" width="14" height="8" rx="1" fill={darkMode ? '#fff' : '#1a1a1a'} />
          </svg>
        </div>
      </div>
      {/* Content area */}
      <div style={{ flex: 1, display: 'flex', flexDirection: 'column', overflow: 'hidden', height: h - statusH }}>
        {children}
      </div>
      {/* Home indicator */}
      <div style={{
        position: 'absolute', bottom: 8 * scale, left: '50%', transform: 'translateX(-50%)',
        width: 134 * scale, height: 5 * scale, borderRadius: 9999, zIndex: 20, opacity: 0.5,
        backgroundColor: darkMode ? '#fff' : '#1a1a1a',
      }} />
    </div>
  );
};

// ==================== SCREEN: Welcome ====================
const ScreenWelcome = ({ darkMode }) => (
  <div className="flex-1 flex flex-col items-center justify-center p-6" style={{ backgroundColor: darkMode ? '#030712' : '#f9fafb' }}>
    <div className="text-5xl mb-4">üåÄ</div>
    <h1 className="text-2xl font-bold mb-2" style={{ color: darkMode ? '#fff' : '#111' }}>Aura</h1>
    <p className="text-sm mb-10 text-center leading-snug" style={{ color: darkMode ? '#9ca3af' : '#6b7280', maxWidth: 220 }}>
      Discover yourself, one question at a time
    </p>
    <div className="w-full px-6" style={{ maxWidth: 280 }}>
      <div className={`w-full py-3.5 px-5 rounded-xl font-semibold text-base text-center ${darkMode ? 'bg-violet-600 text-white' : 'bg-violet-500 text-white'}`}>
        Let's Go
      </div>
    </div>
    <div className="mt-6 text-xs" style={{ color: darkMode ? '#6b7280' : '#9ca3af' }}>Sign In</div>
  </div>
);

// ==================== SCREEN: Sign In ====================
const ScreenSignIn = ({ darkMode }) => (
  <div className="flex-1 flex flex-col items-center justify-center p-6" style={{ backgroundColor: darkMode ? '#030712' : '#f9fafb' }}>
    <div className="text-4xl mb-3">üîë</div>
    <h1 className="text-xl font-bold mb-5" style={{ color: darkMode ? '#fff' : '#111' }}>Sign In</h1>
    <div className="w-full space-y-2.5" style={{ maxWidth: 260 }}>
      <div className={`w-full px-3.5 py-2.5 rounded-xl text-sm ${darkMode ? 'bg-gray-800 text-gray-500' : 'bg-gray-100 text-gray-400'}`}>
        Email
      </div>
      <div className={`w-full px-3.5 py-2.5 rounded-xl text-sm ${darkMode ? 'bg-gray-800 text-gray-500' : 'bg-gray-100 text-gray-400'}`}>
        PIN (4+ digits)
      </div>
      <div className={`w-full py-2.5 px-5 rounded-xl font-medium text-sm text-center ${darkMode ? 'bg-violet-600 text-white' : 'bg-violet-500 text-white'}`}>
        Sign In
      </div>
      <div className="text-center pt-1">
        <span className={`text-xs ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>‚Üê Back</span>
      </div>
      <div className={`text-xs text-center pt-1 ${darkMode ? 'text-gray-600' : 'text-gray-400'}`}>
        No account? <span className={darkMode ? 'text-violet-400' : 'text-violet-500'}>Create one</span>
      </div>
    </div>
  </div>
);

// ==================== SCREEN: Onboarding ====================
const ScreenOnboarding = ({ darkMode }) => {
  const violetShade = darkMode ? ['#5b21b6', '#7c3aed'] : ['#7c3aed', '#8b5cf6'];
  return (
    <div className={`flex-1 flex flex-col ${darkMode ? 'bg-gray-950' : 'bg-gray-50'}`}>
      <div className="flex items-center justify-between px-4 pt-3 pb-1">
        <span className="text-xl">üåÄ</span>
        <span className={`text-lg ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>‚ò∞</span>
      </div>
      <div className="flex-1 flex flex-col items-center justify-center px-5">
        <div className={`text-xs font-medium mb-4 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>
          3 of 10
        </div>
        <h2 className={`text-xl text-center font-medium mb-6 leading-snug ${TH('text-primary', darkMode)}`}>
          Is a hot dog a sandwich?
        </h2>
        <div className="w-full space-y-2.5" style={{ maxWidth: 260 }}>
          <div className="rounded-xl py-3.5 text-center font-bold text-white text-base"
               style={{ background: `linear-gradient(135deg, ${violetShade[0]} 0%, ${violetShade[1]} 100%)` }}>
            Yes, obviously
          </div>
          <div className={`rounded-xl py-3.5 text-center font-bold text-base ${darkMode ? 'bg-gray-800 text-gray-300' : 'bg-white text-gray-600 border-2 border-gray-200'}`}>
            No way
          </div>
        </div>
        <div className="flex gap-1.5 mt-6">
          {[...Array(10)].map((_, i) => (
            <div key={i} className={`w-1.5 h-1.5 rounded-full ${i < 3 ? 'bg-violet-500' : i === 3 ? 'bg-violet-400' : darkMode ? 'bg-gray-700' : 'bg-gray-300'}`} />
          ))}
        </div>
      </div>
    </div>
  );
};

// ==================== SCREEN: Path Choice ====================
const ScreenPathChoice = ({ darkMode }) => (
  <div className={`flex-1 flex flex-col ${darkMode ? 'bg-gray-950' : 'bg-gray-50'}`}>
    <div className="flex items-center justify-between px-4 pt-3 pb-1">
      <span className="text-xl">üåÄ</span>
      <span className={`text-lg ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>‚ò∞</span>
    </div>
    <div className="flex-1 flex flex-col items-center justify-center px-5">
      <div className="text-center mb-6">
        <div className="text-4xl mb-3">üéâ</div>
        <h1 className={`text-xl font-bold mb-1.5 ${darkMode ? 'text-white' : 'text-gray-900'}`}>Nice! 10 down</h1>
        <p className={`text-xs ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>You're on a roll. What next?</p>
      </div>
      <div className="w-full space-y-3" style={{ maxWidth: 280 }}>
        <div className={`w-full p-4 rounded-2xl text-left border ${
          darkMode ? 'border-violet-500/40 bg-gradient-to-r from-violet-900/40 to-violet-950/60' : 'border-violet-300 bg-gradient-to-r from-violet-100 to-violet-50'
        }`}>
          <div className="flex items-center gap-3">
            <span className="text-2xl flex-shrink-0">ü™û</span>
            <div className="flex-1 min-w-0">
              <div className={`text-base font-semibold truncate ${darkMode ? 'text-white' : 'text-gray-900'}`}>Learn About Yourself</div>
              <div className={`text-xs truncate ${darkMode ? 'text-violet-400/80' : 'text-violet-600'}`}>Take a quick personality quiz</div>
            </div>
            <span className={`text-sm flex-shrink-0 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>‚Üí</span>
          </div>
        </div>
        <div className={`w-full p-4 rounded-2xl text-left border ${
          darkMode ? 'border-teal-500/40 bg-gradient-to-r from-teal-900/40 to-teal-950/60' : 'border-teal-300 bg-gradient-to-r from-teal-100 to-teal-50'
        }`}>
          <div className="flex items-center gap-3">
            <span className="text-2xl flex-shrink-0">üß≠</span>
            <div className="flex-1 min-w-0">
              <div className={`text-base font-semibold truncate ${darkMode ? 'text-white' : 'text-gray-900'}`}>Explore Topics</div>
              <div className={`text-xs truncate ${darkMode ? 'text-teal-400/80' : 'text-teal-600'}`}>Answer questions you care about</div>
            </div>
            <span className={`text-sm flex-shrink-0 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>‚Üí</span>
          </div>
        </div>
      </div>
    </div>
  </div>
);

// ==================== SCREEN: Categories (Main Hub) ====================
const ScreenCategories = ({ darkMode }) => (
  <div className={`flex-1 flex flex-col relative ${TH('bg-main', darkMode)}`}>
    <div className="flex items-center justify-between px-4 pt-3 pb-1.5">
      <div className="flex items-center gap-2">
        <span className="text-2xl">üåÄ</span>
        <div className="flex items-center gap-1">
          <span className={`text-xs font-bold ${darkMode ? 'text-violet-400' : 'text-violet-600'}`}>Lv.3</span>
          <span className={`text-[10px] ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>145 XP</span>
        </div>
      </div>
      <div className="flex items-center gap-2">
        <span className="text-xs text-orange-400 font-medium">üî•5</span>
        <div className="w-6 h-6 rounded-full flex items-center justify-center text-xs"
          style={{ background: darkMode ? 'rgba(255,255,255,0.12)' : 'rgba(0,0,0,0.06)',
                   border: `1px solid ${darkMode ? 'rgba(255,255,255,0.2)' : 'rgba(0,0,0,0.1)'}` }}>
          üë§
        </div>
        <span className={`${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>
          <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
          </svg>
        </span>
      </div>
    </div>
    <div className="flex-1 overflow-y-auto px-4 pt-1 pb-6 space-y-3 hide-scrollbar">
      {/* QOTD */}
      <div className={`w-full rounded-xl p-3 text-center ${
        darkMode ? 'bg-gradient-to-br from-blue-900/60 to-blue-950/80 border border-blue-500/40' : 'bg-gradient-to-br from-blue-100 to-blue-50 border border-blue-200'
      }`}>
        <div className={`font-medium text-xs mb-1 ${darkMode ? 'text-blue-400' : 'text-blue-600'}`}>üåÄ Question of the Day</div>
        <p className={`text-sm font-semibold leading-snug ${TH('text-primary', darkMode)}`} style={{ display: '-webkit-box', WebkitLineClamp: 2, WebkitBoxOrient: 'vertical', overflow: 'hidden' }}>
          Should AI systems be required to identify themselves?
        </p>
      </div>
      <h1 className={`text-2xl font-bold text-center ${TH('text-primary', darkMode)}`}>What's on your mind?</h1>
      <div className="space-y-2.5">
        {/* Predict */}
        <div className={`w-full py-3.5 px-4 rounded-xl text-left border overflow-hidden ${
          darkMode ? 'starry-bg border-amber-500/40' : 'bg-gradient-to-r from-amber-100 to-yellow-50 border-amber-400'
        }`}>
          <div className="flex items-center gap-3 relative z-10">
            <span className="text-2xl flex-shrink-0">‚òÄÔ∏è</span>
            <div className="min-w-0">
              <div className={`text-base font-semibold truncate ${TH('text-primary', darkMode)}`}>Predict</div>
              <div className={`text-xs truncate ${darkMode ? 'text-amber-400/80' : 'text-amber-600'}`}>What will happen?</div>
            </div>
          </div>
        </div>
        {/* Think */}
        <div className={`w-full py-3 px-4 rounded-xl text-left border ${
          darkMode ? 'border-violet-500/40 bg-gradient-to-r from-violet-900/30 to-violet-950/50' : 'border-violet-400 bg-gradient-to-r from-violet-100 to-violet-50'
        }`}>
          <div className="flex items-center gap-3">
            <span className="text-xl flex-shrink-0">üß†</span>
            <div className="min-w-0">
              <div className={`text-sm font-semibold truncate ${TH('text-primary', darkMode)}`}>Think</div>
              <div className={`text-xs truncate ${darkMode ? 'text-violet-400/80' : 'text-violet-600'}`}>Logic puzzles & analysis</div>
            </div>
          </div>
        </div>
        {/* Judge */}
        <div className={`w-full py-3 px-4 rounded-xl text-left border ${
          darkMode ? 'border-emerald-500/40 bg-gradient-to-r from-emerald-900/30 to-emerald-950/50' : 'border-emerald-400 bg-gradient-to-r from-emerald-100 to-emerald-50'
        }`}>
          <div className="flex items-center gap-3">
            <span className="text-xl flex-shrink-0">‚öñÔ∏è</span>
            <div className="min-w-0">
              <div className={`text-sm font-semibold truncate ${TH('text-primary', darkMode)}`}>Judge</div>
              <div className={`text-xs truncate ${darkMode ? 'text-emerald-400/80' : 'text-emerald-600'}`}>Ethics & opinions</div>
            </div>
          </div>
        </div>
        {/* Surprise */}
        <div className={`w-full py-3 px-4 rounded-xl text-left border ${
          darkMode ? 'border-rose-500/40 bg-gradient-to-r from-rose-900/30 to-rose-950/50' : 'border-rose-400 bg-gradient-to-r from-rose-100 to-rose-50'
        }`}>
          <div className="flex items-center gap-3">
            <span className="text-xl flex-shrink-0">‚ú®</span>
            <div className="min-w-0">
              <div className={`text-sm font-semibold truncate ${TH('text-primary', darkMode)}`}>Surprise me</div>
              <div className={`text-xs truncate ${darkMode ? 'text-rose-400/80' : 'text-rose-500'}`}>Something unexpected</div>
            </div>
          </div>
        </div>
        {/* Reveal */}
        <div className={`w-full py-3 px-4 rounded-xl text-left border ${
          darkMode ? 'border-sky-500/40 bg-gradient-to-r from-sky-900/30 to-cyan-950/50' : 'border-sky-300 bg-gradient-to-r from-sky-50 to-cyan-50'
        }`}>
          <div className="flex items-center gap-3">
            <span className="text-xl flex-shrink-0">ü™û</span>
            <div className="flex-1 min-w-0">
              <div className={`text-sm font-semibold truncate ${TH('text-primary', darkMode)}`}>Reveal</div>
              <div className={`text-xs truncate ${darkMode ? 'text-sky-400/80' : 'text-sky-600'}`}>Discover yourself</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div className={`pointer-events-none absolute bottom-0 left-0 right-0 h-10 bg-gradient-to-t ${darkMode ? 'from-gray-950' : 'from-gray-100'} to-transparent`} />
  </div>
);

// ==================== SCREEN: Binary Question ====================
const ScreenBinaryQuestion = ({ darkMode }) => (
  <div className={`flex-1 flex flex-col ${TH('bg-main', darkMode)}`}>
    <div className={`flex items-center justify-between px-3 py-1.5 ${darkMode ? 'bg-gray-950/70 border-b border-white/5' : 'bg-white/70 border-b border-gray-200/50'}`}>
      <span className="text-lg">üåÄ</span>
      <span className={`text-xs ${TH('text-muted', darkMode)}`}>42 answered</span>
      <div className="flex items-center gap-1.5">
        <div className={`w-5 h-5 rounded-full flex items-center justify-center text-[10px] ${darkMode ? 'border-gray-600 text-gray-500' : 'border-gray-400 text-gray-400'}`}
          style={{ border: '1px dashed' }}>?</div>
        <span className={`text-lg ${TH('text-muted', darkMode)}`}>‚ò∞</span>
      </div>
    </div>
    <div className="flex-1 flex flex-col justify-center px-3 space-y-3">
      <div className="space-y-1.5 p-3 rounded-xl" style={{ boxShadow: darkMode ? '0 0 15px rgba(251,191,36,0.12)' : 'none' }}>
        <div className="flex justify-center">
          <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${darkMode ? 'bg-amber-900/30 text-amber-400' : 'bg-amber-100 text-amber-700'}`}>
            ‚òÄÔ∏è Predictions
          </span>
        </div>
        <h2 className={`text-lg text-center font-medium leading-snug ${TH('text-primary', darkMode)}`}>
          Will humans live on Mars by 2050?
        </h2>
      </div>
      <div className="flex items-center gap-1.5 px-2">
        <div className="flex-1 relative h-[48px] rounded-xl font-bold overflow-hidden flex items-center justify-center"
             style={{ background: 'linear-gradient(135deg, #047857 0%, #10b981 100%)', boxShadow: '0 0 12px rgba(16,185,129,0.3)', color: 'white' }}>
          <span className="text-xl font-bold">YES</span>
          <span className="text-xs font-medium opacity-70 ml-1">‚òÖ‚òÖ</span>
        </div>
        <div className="w-9 h-[48px] flex-shrink-0 flex flex-col items-center justify-center gap-0.5">
          <div className={`w-5 h-5 rounded-full flex items-center justify-center text-[10px] ${darkMode ? 'bg-gray-700 text-gray-400' : 'bg-gray-200 text-gray-500'}`}>‚úï</div>
          <div className="w-8 h-8 rounded-full text-white shadow-lg flex items-center justify-center text-sm bg-emerald-500">‚úì</div>
        </div>
        <div className={`flex-1 relative h-[48px] rounded-xl font-bold overflow-hidden flex items-center justify-center ${darkMode ? 'bg-gray-800 text-gray-300' : 'bg-white text-rose-600 border-2 border-rose-200'}`}>
          <span className="text-xl font-bold">NO</span>
        </div>
      </div>
    </div>
  </div>
);

// ==================== SCREEN: MC Question ====================
const ScreenMCQuestion = ({ darkMode }) => {
  const MC_COLORS = [
    { hex: '#3b82f6', shades: ['#93c5fd', '#60a5fa', '#3b82f6', '#2563eb'], rgb: '59, 130, 246' },
    { hex: '#8b5cf6', shades: ['#c4b5fd', '#a78bfa', '#8b5cf6', '#7c3aed'], rgb: '139, 92, 246' },
    { hex: '#14b8a6', shades: ['#5eead4', '#2dd4bf', '#14b8a6', '#0d9488'], rgb: '20, 184, 166' },
    { hex: '#06b6d4', shades: ['#67e8f9', '#22d3ee', '#06b6d4', '#0891b2'], rgb: '6, 182, 212' },
  ];
  const options = ['Utilitarianism vs duty', 'Action vs inaction', 'Individual vs collective', 'Moral intuition vs logic'];
  const selectedIdx = 1;
  const tapCount = 2;

  return (
    <div className={`flex-1 flex flex-col ${TH('bg-main', darkMode)}`}>
      <div className={`flex items-center justify-between px-3 py-1.5 ${darkMode ? 'bg-gray-950/70 border-b border-white/5' : 'bg-white/70 border-b border-gray-200/50'} backdrop-blur-md`}>
        <span className="text-lg">üåÄ</span>
        <span className={`text-xs ${TH('text-muted', darkMode)}`}>42 answered</span>
        <div className="flex items-center gap-1.5">
          <div className={`w-5 h-5 rounded-full flex items-center justify-center text-[10px] ${darkMode ? 'border-gray-600 text-gray-500' : 'border-gray-400 text-gray-400'}`}
            style={{ border: '1px dashed' }}>?</div>
          <span className={`text-lg ${TH('text-muted', darkMode)}`}>‚ò∞</span>
        </div>
      </div>
      <div className="flex-1 flex flex-col justify-center px-3 space-y-3">
        <div className="space-y-1.5 p-3 rounded-xl" style={{ boxShadow: darkMode ? '0 0 16px rgba(139,92,246,0.16)' : 'none' }}>
          <div className="flex justify-center">
            <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${darkMode ? 'bg-violet-900/30 text-violet-400' : 'bg-violet-100 text-violet-700'}`}>
              üß† Reasoning
            </span>
          </div>
          <h2 className={`text-base text-center font-medium leading-snug ${TH('text-primary', darkMode)}`}>
            The trolley problem is fundamentally about...
          </h2>
        </div>
        <div className="px-2 space-y-1">
          {options.map((opt, i) => {
            const color = MC_COLORS[i % MC_COLORS.length];
            const isSelected = i === selectedIdx;
            const style = isSelected
              ? { background: `linear-gradient(135deg, ${color.shades[tapCount - 1]} 0%, ${color.shades[Math.min(tapCount, 3)]} 100%)`, boxShadow: `0 0 ${tapCount * 5}px rgba(${color.rgb}, ${0.2 + tapCount * 0.1})`, color: 'white', border: `2px solid ${color.hex}` }
              : { background: darkMode ? 'rgb(31,41,55)' : 'rgb(255,255,255)', color: darkMode ? 'rgb(209,213,219)' : 'rgb(55,65,81)', border: darkMode ? '2px solid transparent' : '2px solid rgb(229,231,235)' };
            return (
              <div key={i} className="flex items-center gap-1">
                <div className="flex-1 h-[36px] px-2.5 rounded-lg text-left text-sm overflow-hidden relative flex items-center"
                     style={style}>
                  <span className="font-medium mr-1 opacity-60 text-xs">{String.fromCharCode(65 + i)}.</span>
                  <span className="truncate text-xs">{opt}</span>
                  {isSelected && (
                    <span className="absolute top-1/2 right-1.5 -translate-y-1/2 text-[10px] font-bold bg-white/30 w-4 h-4 rounded-full flex items-center justify-center">
                      {tapCount}
                    </span>
                  )}
                </div>
                <div className="w-8 h-[36px] flex-shrink-0 flex flex-col items-center justify-center">
                  {isSelected && (
                    <>
                      <div className={`w-3.5 h-3.5 rounded-full flex items-center justify-center text-[8px] ${darkMode ? 'bg-gray-700 text-gray-400' : 'bg-gray-200 text-gray-500'}`}>‚úï</div>
                      <div className="w-6 h-6 rounded-full text-white shadow-lg flex items-center justify-center text-xs"
                           style={{ backgroundColor: color.hex }}>‚úì</div>
                    </>
                  )}
                </div>
              </div>
            );
          })}
        </div>
      </div>
    </div>
  );
};

// ==================== SCREEN: Results ====================
const ScreenResults = ({ darkMode }) => {
  const yesColors = ['#10b981', '#34d399', '#6ee7b7', '#a7f3d0'];
  const noColors = ['#f43f5e', '#fb7185', '#fda4af', '#fecaca'];
  const yesByConf = [38, 28, 18, 8];
  const noByConf = [15, 12, 8, 5];
  const maxCount = 38;
  const highlightColor = darkMode ? 'white' : '#6b7280';

  const buildSegments = (byConf, colors) => {
    const segs = [];
    for (let i = 0; i < 4; i++) {
      if (byConf[i] > 0) segs.push({ width: (byConf[i] / maxCount) * 100, color: colors[i], conf: 3 - i });
    }
    return segs;
  };

  const rows = [
    { label: 'Yes', pct: '69%', byConf: yesByConf, colors: yesColors, isUser: true, userConf: 2 },
    { label: 'No', pct: '31%', byConf: noByConf, colors: noColors, isUser: false, userConf: null },
  ];

  return (
    <div className={`flex-1 flex flex-col ${TH('bg-main', darkMode)}`}>
      <div className={`flex items-center justify-between px-3 py-1.5 ${darkMode ? 'bg-gray-950/70 border-b border-white/5' : 'bg-white/70 border-b border-gray-200/50'}`}>
        <span className="text-lg">üåÄ</span>
        <span className={`text-xs ${TH('text-muted', darkMode)}`}>43 answered</span>
        <div className="flex items-center gap-1.5">
          <div className={`w-5 h-5 rounded-full flex items-center justify-center text-[10px] ${darkMode ? 'border-gray-600 text-gray-500' : 'border-gray-400 text-gray-400'}`}
            style={{ border: '1px dashed' }}>?</div>
          <span className={`text-lg ${TH('text-muted', darkMode)}`}>‚ò∞</span>
        </div>
      </div>
      <div className="flex-1 overflow-y-auto px-3 py-4 space-y-3">
        {/* Mini results */}
        <div className={`w-full px-2.5 py-2 rounded-lg text-left ${darkMode ? 'bg-gray-900/80' : 'bg-gray-100'}`}>
          <div className={`text-xs font-medium mb-1 truncate ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
            Will humans live on Mars by 2050?
          </div>
          <div className="space-y-0.5">
            {rows.map((row, ri) => {
              const segments = buildSegments(row.byConf, row.colors);
              const totalWidth = segments.reduce((a, s) => a + s.width, 0);
              const emptyWidth = 100 - totalWidth;
              return (
                <div key={ri} className="flex items-center gap-1.5">
                  <span className={`text-[10px] w-6 ${row.isUser ? 'font-bold' : ''}`} style={{ color: row.colors[0] }}>{row.label}</span>
                  <span className="text-[10px] w-5" style={{ color: row.colors[0] }}>{row.pct}</span>
                  <div className={`flex-1 h-1.5 rounded-full overflow-hidden ${darkMode ? 'bg-black' : 'bg-gray-300'}`}>
                    <div className="h-full flex">
                      {segments.map((s, i) => (
                        <div key={i} className={`h-full ${i === 0 ? 'rounded-l-full' : ''} ${i === segments.length - 1 && emptyWidth <= 0 ? 'rounded-r-full' : ''}`}
                          style={{ width: `${s.width}%`, backgroundColor: s.color }} />
                      ))}
                      {emptyWidth > 0 && <div className="h-full rounded-r-full" style={{ width: `${emptyWidth}%`, border: `1px solid ${row.colors[3]}`, borderLeft: 'none' }} />}
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
          <div className={`text-[10px] text-right mt-0.5 ${TH('text-faint', darkMode)}`}>1,847 responses ‚Üí</div>
        </div>

        {/* Full results */}
        <div className={`rounded-lg p-2.5 ${darkMode ? 'bg-gray-900' : 'bg-white border border-gray-200'}`}>
          <div className="flex items-center gap-1.5 mb-0.5">
            <span className={`text-[10px] font-black uppercase tracking-wide ${darkMode ? 'text-sky-300' : 'text-sky-500'}`}>LAST:</span>
            <span className={`text-[10px] ${TH('text-subtle', darkMode)}`}>1,847 responses</span>
          </div>
          <p className={`text-xs font-medium mb-2 truncate ${TH('text-bright', darkMode)}`}>Will humans live on Mars by 2050?</p>
          <div className="space-y-1">
            {rows.map((row, ri) => {
              const segments = buildSegments(row.byConf, row.colors);
              const totalWidth = segments.reduce((a, s) => a + s.width, 0);
              const emptyWidth = 100 - totalWidth;
              return (
                <div key={ri} className="flex items-center gap-1">
                  <div className="w-10 flex-shrink-0">
                    <span className={`text-xs font-semibold truncate ${row.isUser ? 'border rounded-full px-1' : ''}`}
                      style={{ color: row.colors[1], borderColor: row.isUser ? highlightColor : 'transparent', fontSize: 10 }}>
                      {row.label}
                    </span>
                  </div>
                  <span className="text-xs w-6 font-bold text-right" style={{ color: row.colors[1], fontSize: 10 }}>{row.pct}</span>
                  <div className={`flex-1 h-3.5 rounded-full overflow-hidden ${darkMode ? 'bg-black/50' : 'bg-gray-200'}`}>
                    <div className="h-full flex">
                      {segments.map((s, i) => {
                        const isUserSeg = row.isUser && s.conf === row.userConf;
                        return (
                          <div key={i} className={`h-full relative flex items-center justify-center ${i === 0 ? 'rounded-l-full' : ''} ${i === segments.length - 1 && emptyWidth <= 0 ? 'rounded-r-full' : ''}`}
                            style={{ width: `${s.width}%`, backgroundColor: s.color }}>
                            {isUserSeg && <span className="text-[7px] font-black" style={{ color: 'white' }}>‚úì</span>}
                          </div>
                        );
                      })}
                      {emptyWidth > 0 && <div className="h-full rounded-r-full" style={{ width: `${emptyWidth}%`, border: `1px solid ${row.colors[3]}`, borderLeft: 'none' }} />}
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
          <div className={`text-[10px] text-center mt-1 ${TH('text-faint', darkMode)}`}>1,847 responses ¬∑ Demo</div>
        </div>
        <div className={`text-center text-xs ${TH('text-faint', darkMode)}`}>Swipe for next ‚Üí</div>
      </div>
    </div>
  );
};

// ==================== SCREEN: Settings ====================
const ScreenSettings = ({ darkMode }) => (
  <div className={`flex-1 flex flex-col overflow-hidden ${TH('bg-main', darkMode)}`}>
    <div className={`flex items-center justify-between px-3 py-2 border-b ${TH('border-base', darkMode)}`}>
      <span className={`text-xs ${TH('text-violet', darkMode)}`}>‚Üê Back</span>
      <h1 className={`text-sm font-semibold ${TH('text-primary', darkMode)}`}>Settings</h1>
      <div className="w-10" />
    </div>
    <div className="flex-1 overflow-y-auto p-3 space-y-2 hide-scrollbar">
      {/* Theme */}
      <div className={`rounded-lg p-2.5 ${darkMode ? 'bg-gray-900' : 'bg-white border border-gray-200'}`}>
        <div className="flex items-center justify-between">
          <div className={`text-xs font-medium ${TH('text-primary', darkMode)}`}>Theme</div>
          <div className={`relative w-10 h-5 rounded-full ${darkMode ? 'bg-violet-600' : 'bg-gray-200'}`}>
            <div className={`absolute top-0.5 w-4 h-4 bg-white rounded-full shadow flex items-center justify-center text-[10px] ${darkMode ? 'translate-x-5' : 'translate-x-0.5'}`}>
              {darkMode ? 'üåô' : '‚òÄÔ∏è'}
            </div>
          </div>
        </div>
      </div>
      {/* Undo delay */}
      <div className={`rounded-lg p-2.5 ${darkMode ? 'bg-gray-900' : 'bg-white border border-gray-200'}`}>
        <div className="flex items-center justify-between mb-1">
          <div className={`text-xs font-medium ${TH('text-primary', darkMode)}`}>Undo Delay</div>
          <span className={`text-xs font-bold ${TH('text-violet', darkMode)}`}>2s</span>
        </div>
        <div className={`w-full h-1 rounded-lg ${darkMode ? 'bg-gray-700' : 'bg-gray-200'}`}>
          <div className="h-full rounded-lg bg-violet-500" style={{ width: '66%' }} />
        </div>
      </div>
      {/* Toggles */}
      {[
        { label: 'Require Submit', sub: 'Off = auto-submit', on: true },
        { label: 'Show Tips', sub: 'Gesture hints', on: true },
        { label: 'Streak Counter', sub: 'Show fire during play', on: true },
        { label: 'Demo Profiles', sub: 'Sample data', on: false },
      ].map((item, i) => (
        <div key={i} className={`rounded-lg p-2.5 ${darkMode ? 'bg-gray-900' : 'bg-white border border-gray-200'}`}>
          <div className="flex items-center justify-between">
            <div className="min-w-0 flex-1 mr-2">
              <div className={`text-xs font-medium truncate ${TH('text-primary', darkMode)}`}>{item.label}</div>
              <div className={`text-[10px] truncate ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>{item.sub}</div>
            </div>
            <div className={`relative w-9 h-5 rounded-full flex-shrink-0 ${item.on ? 'bg-violet-600' : darkMode ? 'bg-gray-600' : 'bg-gray-200'}`}>
              <div className={`absolute top-0.5 w-4 h-4 bg-white rounded-full shadow ${item.on ? 'translate-x-4' : 'translate-x-0.5'}`} />
            </div>
          </div>
        </div>
      ))}
      {/* Keyboard shortcuts */}
      <div className={`rounded-lg p-2.5 ${darkMode ? 'bg-gray-900/50 border border-gray-800' : 'bg-white border border-gray-200'}`}>
        <div className={`text-xs font-medium mb-1 ${TH('text-dim', darkMode)}`}>Keyboard Shortcuts</div>
        <div className={`text-[10px] space-y-0.5 ${darkMode ? 'text-gray-500' : 'text-gray-600'}`}>
          <div className="flex justify-between"><span>Yes / A</span><span className="font-mono">Y or 1</span></div>
          <div className="flex justify-between"><span>No / B-E</span><span className="font-mono">N or 2-5</span></div>
          <div className="flex justify-between"><span>Next</span><span className="font-mono">‚Üí or Space</span></div>
        </div>
      </div>
      {/* Data */}
      <div className={`rounded-lg p-2.5 ${darkMode ? 'bg-gray-900' : 'bg-white border border-gray-200'}`}>
        <div className={`text-xs font-medium mb-1.5 ${TH('text-primary', darkMode)}`}>Your Data</div>
        <div className="flex gap-1.5">
          <div className={`flex-1 py-1.5 rounded-lg text-[10px] font-medium text-center ${darkMode ? 'bg-emerald-900/30 text-emerald-400' : 'bg-emerald-100 text-emerald-600'}`}>Export</div>
          <div className={`flex-1 py-1.5 rounded-lg text-[10px] font-medium text-center ${darkMode ? 'bg-blue-900/30 text-blue-400' : 'bg-blue-100 text-blue-600'}`}>Import</div>
        </div>
      </div>
      <div className="flex gap-1.5">
        <div className={`flex-1 py-1.5 rounded-lg text-[10px] font-medium text-center ${darkMode ? 'bg-amber-900/30 text-amber-400' : 'bg-amber-100 text-amber-600'}`}>Clear</div>
        <div className={`flex-1 py-1.5 rounded-lg text-[10px] font-medium text-center ${darkMode ? 'bg-rose-900/30 text-rose-400' : 'bg-rose-100 text-rose-600'}`}>Reset</div>
      </div>
      <div className={`text-[10px] text-center ${TH('text-faint', darkMode)}`}>Aura Player vR-Data</div>
    </div>
  </div>
);

// ==================== SCREEN: Assessment Hub ====================
const ScreenAssessments = ({ darkMode }) => {
  const Circle = ({ progress, size, sw, color, children, id }) => {
    const r = (size - sw) / 2;
    const circ = 2 * Math.PI * r;
    const grad = PROGRESS_GRADIENTS[color] || PROGRESS_GRADIENTS.violet;
    const gId = id || `ac-${size}-${color}-${progress}`;
    return (
      <div className="relative flex items-center justify-center" style={{ width: size, height: size }}>
        <svg width={size} height={size} className="absolute">
          <defs>
            <linearGradient id={gId} x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stopColor={progress > 0 ? grad.from : (darkMode ? '#374151' : '#9ca3af')} />
              <stop offset="100%" stopColor={progress > 0 ? grad.to : (darkMode ? '#4b5563' : '#d1d5db')} />
            </linearGradient>
          </defs>
          <circle cx={size/2} cy={size/2} r={r} fill="none" stroke={darkMode ? '#1f2937' : '#c7d0dc'} strokeWidth={sw} />
          <circle cx={size/2} cy={size/2} r={r} fill="none" stroke={`url(#${gId})`} strokeWidth={sw} strokeLinecap="round"
            strokeDasharray={circ} strokeDashoffset={circ * (1 - progress / 100)}
            transform={`rotate(-90 ${size/2} ${size/2})`} />
        </svg>
        <span className="relative z-10">{children}</span>
      </div>
    );
  };

  return (
    <div className={`flex-1 flex flex-col ${TH('bg-main', darkMode)}`}>
      <div className={`h-[38px] flex-shrink-0 flex items-center gap-2 px-3 border-b ${TH('border-base', darkMode)}`}>
        <span className={darkMode ? 'text-gray-400' : 'text-gray-500'} style={{ fontSize: 12 }}>‚Üê</span>
        <span className="text-lg select-none">ü™û</span>
        <span className={`text-xs font-semibold flex-1 truncate ${TH('text-primary', darkMode)}`}>Reveal</span>
        <span className="px-2 py-1 rounded-full text-[10px] font-medium bg-violet-600 text-white">Analysis</span>
      </div>
      <div className="flex-1 overflow-auto p-3 pb-16 hide-scrollbar">
        <div className="space-y-2 mb-4">
          {/* Quick Profile */}
          <div className={`w-full p-3 rounded-xl ${TH('bg-card', darkMode)} flex items-center gap-3`}>
            <Circle progress={40} size={44} sw={3} color="blue" id="pick-qp">
              <span className="text-xs font-medium" style={{ color: PROGRESS_GRADIENTS.blue.to }}>10</span>
            </Circle>
            <div className="flex-1 min-w-0">
              <div className={`text-xs font-semibold truncate ${TH('text-primary', darkMode)}`}>Quick Profile</div>
              <div className={`text-[10px] ${darkMode ? 'text-blue-400' : 'text-blue-600'}`}>40% done</div>
            </div>
            <span className={`text-[10px] font-medium px-2 py-1 rounded-full flex-shrink-0 ${darkMode ? 'bg-blue-600/20 text-blue-400' : 'bg-blue-100 text-blue-600'}`}>Continue</span>
          </div>
          {/* Starter Pack */}
          <div className={`rounded-xl overflow-hidden ${TH('bg-card', darkMode)}`}>
            <div className="w-full p-3 text-left flex items-center gap-2">
              <Circle progress={33} size={40} sw={3} color="indigo" id="pick-starter">
                <span className="text-[10px] font-medium" style={{ color: PROGRESS_GRADIENTS.indigo.to }}>2</span>
              </Circle>
              <div className="flex-1 min-w-0">
                <div className={`text-xs font-semibold truncate ${TH('text-primary', darkMode)}`}>Starter Pack</div>
                <div className={`text-[10px] ${darkMode ? 'text-indigo-400' : 'text-indigo-600'}`}>2 left</div>
              </div>
              <div className="flex gap-0.5 items-center flex-shrink-0">
                {[['üé≠',100],['üî•',62],['üí°',0]].map(([icon, pct], j) => (
                  <Circle key={j} progress={pct} size={22} sw={2} color="indigo" id={`mod-ring-${j}`}>
                    <span style={{ fontSize: 8 }}>{icon}</span>
                  </Circle>
                ))}
              </div>
              <span className={`text-xs ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>‚Ä∫</span>
            </div>
            <div className={`divide-y ${darkMode ? 'divide-gray-800/50' : 'divide-gray-200'} border-t ${darkMode ? 'border-gray-800/50' : 'border-gray-200'}`}>
              {/* Completed */}
              <div className="w-full px-2.5 py-1.5 flex items-center gap-1.5">
                <span className="text-xs w-4">üé≠</span>
                <span className={`text-[10px] truncate flex-1 ${TH('text-secondary', darkMode)}`}>Personality</span>
                <div className="w-16 h-1.5 rounded-full relative" style={{ background: `linear-gradient(to right, ${PROGRESS_GRADIENTS.indigo.from}, ${PROGRESS_GRADIENTS.indigo.to})` }}>
                  <div className="absolute top-1/2 -translate-y-1/2 w-2 h-2 rounded-full bg-white"
                    style={{ left: '65%', marginLeft: -4, boxShadow: '0 1px 2px rgba(0,0,0,0.25)' }} />
                </div>
              </div>
              {/* In-progress */}
              <div className="w-full px-2.5 py-1.5">
                <div className="flex items-center gap-1.5 mb-1">
                  <span className="text-xs">üî•</span>
                  <div className={`flex-1 min-w-0 text-[10px] font-medium truncate ${TH('text-primary', darkMode)}`}>Motivation</div>
                  <span className={`text-[9px] ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>5/8</span>
                </div>
                <div className="h-1.5 rounded-full relative" style={{ background: darkMode ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)' }}>
                  <div className="absolute inset-y-0 left-0 rounded-full" style={{ width: '62.5%', background: `linear-gradient(to right, ${PROGRESS_GRADIENTS.indigo.from}, ${PROGRESS_GRADIENTS.indigo.to})` }} />
                </div>
              </div>
              {/* Not started */}
              <div className="w-full px-2.5 py-1.5">
                <div className="flex items-center gap-1.5 mb-1">
                  <span className="text-xs">üí°</span>
                  <div className={`flex-1 min-w-0 text-[10px] font-medium truncate ${TH('text-primary', darkMode)}`}>Thinking Style</div>
                  <span className={`text-[9px] ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>0/8</span>
                </div>
                <div className="h-1.5 rounded-full" style={{ background: darkMode ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)' }} />
              </div>
            </div>
          </div>
          {/* Not started */}
          <div className={`w-full p-3 rounded-xl ${TH('bg-card', darkMode)} flex items-center gap-3 opacity-70`}>
            <Circle progress={0} size={44} sw={3} color="violet" id="pick-deep">
              <span className="text-xs font-medium" style={{ color: darkMode ? '#6b7280' : '#9ca3af' }}>40</span>
            </Circle>
            <div className="flex-1 min-w-0">
              <div className={`text-xs font-semibold truncate ${TH('text-primary', darkMode)}`}>Personality Deep</div>
              <div className={`text-[10px] ${darkMode ? 'text-violet-400' : 'text-violet-600'}`}>40 questions</div>
            </div>
            <span className={`text-[10px] font-medium px-2 py-1 rounded-full flex-shrink-0 ${darkMode ? 'bg-violet-600/20 text-violet-400' : 'bg-violet-100 text-violet-600'}`}>Start</span>
          </div>
        </div>
        {/* Completed */}
        <div className="mt-1">
          <div className={`text-[9px] font-medium uppercase tracking-wide mb-1.5 px-1 ${TH('text-dim', darkMode)}`}>
            Completed ¬∑ Tap to view
          </div>
          <div className={`rounded-xl overflow-hidden ${TH('bg-card', darkMode)}`}>
            <div className="w-full px-2.5 py-2 flex items-center gap-2">
              <Circle progress={100} size={28} sw={2} color="emerald" id="pick-char">
                <span style={{ fontSize: 10 }}>üõ°Ô∏è</span>
              </Circle>
              <span className={`flex-1 text-left text-xs font-medium truncate ${TH('text-primary', darkMode)}`}>Character</span>
              <span className={`text-[10px] ${darkMode ? 'text-emerald-400' : 'text-emerald-600'}`}>View ‚Üí</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

// ==================== SCREEN: Assessment Taking ====================
const ScreenAssessmentTaking = ({ darkMode }) => {
  const scaleLabels = [
    { v: 1, l: 'Not like me' },
    { v: 2, l: 'A little unlike me' },
    { v: 3, l: 'Neutral' },
    { v: 4, l: 'A little like me' },
    { v: 5, l: 'Very like me' },
  ];
  const totalQ = 10;
  const currentIdx = 3;
  const selectedAnswer = 4;

  const gradientTints = darkMode
    ? ['bg-blue-950/30 border-blue-800/40', 'bg-blue-950/50 border-blue-700/50', 'bg-blue-900/40 border-blue-600/50', 'bg-blue-900/60 border-blue-500/60', 'bg-blue-800/70 border-blue-400/70']
    : ['bg-blue-50/60 border-blue-200', 'bg-blue-50 border-blue-200', 'bg-blue-100/70 border-blue-300', 'bg-blue-100 border-blue-300', 'bg-blue-200/80 border-blue-400'];

  const segments = Array.from({ length: totalQ }, (_, i) => ({
    isAnswered: i < currentIdx,
    isCurrent: i === currentIdx,
  }));

  return (
    <div className={`flex-1 flex flex-col ${TH('bg-main', darkMode)}`}>
      <div className={`h-[36px] flex-shrink-0 flex items-center gap-1.5 px-2.5 border-b ${TH('border-base', darkMode)}`}>
        <span className={`text-[10px] font-semibold ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>Save</span>
        <span className={`text-base font-bold w-6 h-6 flex items-center justify-center ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>‚óÄ</span>
        <div className="flex-1 text-center">
          <div className={`text-[9px] ${darkMode ? 'text-blue-400' : 'text-blue-600'}`}>Quick Profile</div>
          <div className={`text-xs font-medium ${TH('text-primary', darkMode)}`}>{currentIdx + 1} / {totalQ}</div>
        </div>
        <span className={`text-base font-bold w-6 h-6 flex items-center justify-center ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>‚ñ∂</span>
        <span className={`text-[10px] font-semibold ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>Exit</span>
      </div>
      <div className={`flex h-2 gap-px px-1 py-0.5 ${darkMode ? 'bg-gray-900' : 'bg-gray-100'}`}>
        {segments.map((seg, i) => (
          <div key={i} className={`flex-1 rounded-sm ${
            seg.isAnswered ? 'bg-blue-500'
            : seg.isCurrent ? (darkMode ? 'bg-white' : 'bg-gray-900')
            : (darkMode ? 'bg-gray-800' : 'bg-gray-300')
          }`} />
        ))}
      </div>
      <div className="flex-1 flex flex-col">
        <div className="flex-1 flex flex-col justify-center px-3 pb-2">
          <div className={`p-4 rounded-xl ${darkMode ? 'bg-gray-900 border border-gray-800' : 'bg-white border border-gray-200'}`}>
            <h2 className={`text-base font-medium text-center leading-relaxed ${TH('text-primary', darkMode)}`}>
              I enjoy being the center of attention
            </h2>
          </div>
        </div>
        <div className="flex-shrink-0 px-3 pb-3 space-y-1.5">
          {scaleLabels.map((option, i) => {
            const isSelected = option.v === selectedAnswer;
            return (
              <div key={option.v} className={`w-full py-2.5 px-3 rounded-xl flex items-center justify-between border relative overflow-hidden text-xs ${
                isSelected
                  ? `bg-blue-600 ring-blue-400 border-blue-400 text-white ring-2 ring-offset-1 ${darkMode ? 'ring-offset-gray-950' : 'ring-offset-white'}`
                  : `${gradientTints[i]} ${darkMode ? 'text-gray-200' : 'text-gray-700'}`
              }`}>
                <span className="text-left truncate">{option.l}</span>
                <span className={`text-[10px] font-medium flex-shrink-0 ml-1 ${isSelected ? 'text-white/70' : (darkMode ? 'text-blue-400/70' : 'text-blue-500/70')}`}>{option.v}</span>
              </div>
            );
          })}
        </div>
      </div>
    </div>
  );
};

// ==================== SCREEN: Assessment Results ====================
const ScreenAssessmentResults = ({ darkMode }) => {
  const testColor = 'violet';
  const grad = PROGRESS_GRADIENTS[testColor];
  const traits = [
    { name: 'Extraversion', low: 'Reserved', high: 'Outgoing', score: 35 },
    { name: 'Agreeableness', low: 'Analytical', high: 'Empathetic', score: 72 },
    { name: 'Conscientiousness', low: 'Flexible', high: 'Organized', score: 58 },
    { name: 'Neuroticism', low: 'Calm', high: 'Sensitive', score: 45 },
    { name: 'Openness', low: 'Practical', high: 'Curious', score: 81 },
  ];

  const TraitSpectrum = ({ name, score, low, high }) => (
    <div className="py-0.5">
      {name && <div className={`text-[10px] font-medium mb-0.5 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>{name}</div>}
      <div className="flex justify-between" style={{ fontSize: 8 }}>
        <span className={darkMode ? 'text-gray-500' : 'text-gray-600'}>{low}</span>
        <span className={darkMode ? 'text-gray-500' : 'text-gray-600'}>{high}</span>
      </div>
      <div className="h-2 rounded-full relative" style={{ background: `linear-gradient(to right, ${grad.from}, ${grad.to})` }}>
        <div className="absolute top-1/2 -translate-y-1/2 w-3 h-3 rounded-full bg-white"
          style={{ left: `${Math.max(5, Math.min(95, score))}%`, marginLeft: -6, boxShadow: '0 1px 2px rgba(0,0,0,0.25)' }} />
      </div>
    </div>
  );

  return (
    <div className={`flex-1 flex flex-col ${TH('bg-main', darkMode)}`}>
      <div className={`h-[36px] flex-shrink-0 flex items-center gap-1.5 px-2.5 border-b ${TH('border-base', darkMode)}`}>
        <span className={darkMode ? 'text-gray-400' : 'text-gray-500'} style={{ fontSize: 12 }}>‚Üê</span>
        <span className={`text-xs font-semibold flex-1 text-center truncate ${TH('text-primary', darkMode)}`}>Quick Profile</span>
        <div className="w-3" />
      </div>
      <div className="flex-1 overflow-y-auto p-3 space-y-2.5 hide-scrollbar">
        {/* Result card */}
        <div className={`rounded-xl overflow-hidden ${darkMode ? 'bg-gray-900/80 border border-gray-800' : 'bg-white border border-gray-200'}`}>
          <div className="p-4 bg-gradient-to-br from-violet-600 to-violet-400">
            <div className="text-center">
              <span className="text-3xl">‚ö°</span>
              <h2 className="text-white text-base font-bold mt-1">Quick Profile Complete</h2>
              <p className="text-white/70 text-[10px] mt-0.5">Based on 10 responses</p>
            </div>
          </div>
          <div className="p-3 space-y-2">
            {/* Score gauge */}
            <div className="text-center">
              <div className="relative w-16 h-16 mx-auto">
                <svg className="w-16 h-16 transform -rotate-90">
                  <circle cx="32" cy="32" r="26" stroke={darkMode ? '#374151' : '#c7d0dc'} strokeWidth="5" fill="none" />
                  <circle cx="32" cy="32" r="26" stroke="url(#scoreGrad)" strokeWidth="5" fill="none" strokeLinecap="round"
                    strokeDasharray={`${(65 / 100) * 163.4} 163.4`} />
                  <defs><linearGradient id="scoreGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" stopColor="#8b5cf6" /><stop offset="100%" stopColor="#a78bfa" />
                  </linearGradient></defs>
                </svg>
                <div className="absolute inset-0 flex items-center justify-center">
                  <span className={`text-base font-bold ${darkMode ? 'text-violet-400' : 'text-violet-600'}`}>65%</span>
                </div>
              </div>
              <div className={`text-[9px] mt-1 ${TH('text-dim', darkMode)}`}>Overall Score</div>
            </div>
            {/* Traits */}
            {traits.map((t, i) => (
              <TraitSpectrum key={i} name={t.name} score={t.score} low={t.low} high={t.high} />
            ))}
            {/* Insights */}
            <div className="space-y-1.5 pt-1">
              {[
                { emoji: 'üí™', label: 'Strength', text: 'Deep thinker who recharges through reflection' },
                { emoji: 'üåë', label: 'Shadow', text: 'Networking can feel draining' },
                { emoji: 'üí°', label: 'Growth', text: 'Prep conversation starters before events' },
              ].map((ins, i) => (
                <div key={i} className="flex gap-2">
                  <span className="text-sm flex-shrink-0">{ins.emoji}</span>
                  <div className="flex-1 min-w-0">
                    <div className={`text-[9px] font-medium uppercase tracking-wide ${darkMode ? 'text-violet-400' : 'text-violet-600'}`}>{ins.label}</div>
                    <p className={`text-[10px] mt-0.5 leading-tight ${darkMode ? 'text-gray-300' : 'text-gray-600'}`} style={{ display: '-webkit-box', WebkitLineClamp: 2, WebkitBoxOrient: 'vertical', overflow: 'hidden' }}>{ins.text}</p>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

// ==================== MODAL: Save Progress ====================
const ScreenSaveModal = ({ darkMode }) => (
  <div className={`flex-1 flex flex-col ${TH('bg-main', darkMode)}`}>
    <div className="flex-1 flex items-center justify-center" style={{ backgroundColor: darkMode ? 'rgba(0,0,0,0.7)' : 'rgba(0,0,0,0.12)' }}>
      <div className={`w-full rounded-xl p-5 ${darkMode ? 'bg-gray-900' : 'bg-white shadow-2xl'}`} style={{ maxWidth: 260, margin: '0 16px' }}>
        <div className="text-3xl text-center mb-2">üéâ</div>
        <h2 className={`text-base font-bold text-center mb-1.5 ${darkMode ? 'text-white' : 'text-gray-900'}`}>20 responses!</h2>
        <p className={`text-xs text-center mb-4 leading-snug ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>
          Save your progress?<br/>Sync across devices.
        </p>
        <div className="space-y-1.5">
          <div className={`w-full py-2.5 rounded-xl font-medium text-xs text-center ${darkMode ? 'bg-violet-600 text-white' : 'bg-violet-500 text-white'}`}>Create Account</div>
          <div className={`w-full py-2.5 rounded-xl font-medium text-xs text-center ${darkMode ? 'bg-gray-800 text-gray-400' : 'bg-gray-100 text-gray-600'}`}>Later</div>
        </div>
      </div>
    </div>
  </div>
);

// ==================== MODAL: Level Up ====================
const ScreenLevelUp = ({ darkMode }) => (
  <div className={`flex-1 flex flex-col ${TH('bg-main', darkMode)}`}>
    <div className="flex-1 flex items-center justify-center" style={{ backgroundColor: darkMode ? 'rgba(0,0,0,0.85)' : 'rgba(0,0,0,0.12)' }}>
      <div className={`w-full rounded-xl p-6 text-center ${darkMode ? 'bg-gray-900' : 'bg-white shadow-2xl'}`} style={{ maxWidth: 260, margin: '0 16px' }}>
        <div className="relative">
          <div className="absolute inset-0 flex items-center justify-center">
            <div className="w-24 h-24 rounded-full bg-gradient-to-br from-violet-500/20 to-amber-500/20 animate-pulse" />
          </div>
          <div className="relative z-10 text-5xl mb-3 celebrate-glow">üéâ</div>
        </div>
        <h2 className={`text-xl font-bold mb-1 ${darkMode ? 'text-white' : 'text-gray-900'}`}>Level Up!</h2>
        <div className={`text-4xl font-bold mb-1 ${darkMode ? 'text-violet-400' : 'text-violet-600'}`}>5</div>
        <p className={`text-base font-medium mb-4 ${darkMode ? 'text-violet-300' : 'text-violet-500'}`}>Thinker</p>
        <div className={`w-full py-2.5 rounded-xl font-medium text-sm ${darkMode ? 'bg-violet-600 text-white' : 'bg-violet-500 text-white'}`}>Continue</div>
      </div>
    </div>
  </div>
);

// ==================== SCREEN: Profile ====================
const ScreenProfile = ({ darkMode }) => {
  const auraStyle = {
    boxShadow: '0 0 15px 4px rgba(139,92,246,0.3), 0 0 25px 8px rgba(16,185,129,0.2)',
    border: '2px solid rgba(139,92,246,0.5)'
  };

  return (
    <div className={`flex-1 flex flex-col overflow-hidden ${darkMode ? 'text-white bg-gray-950' : 'text-gray-900 bg-gray-50'}`}>
      <div className={`h-[36px] flex-shrink-0 flex items-center gap-1.5 px-2.5 border-b ${TH('border-base', darkMode)}`}>
        <span className={darkMode ? 'text-gray-400' : 'text-gray-500'} style={{ fontSize: 12 }}>‚Üê</span>
        <span className="text-xs font-medium flex-1">Profile</span>
      </div>
      <div className="flex-1 p-3 overflow-y-auto space-y-3 hide-scrollbar">
        {/* Avatar */}
        <div className="flex items-center gap-3">
          <div className="w-12 h-12 bg-gradient-to-br from-violet-500 to-fuchsia-500 rounded-full flex items-center justify-center font-bold text-sm text-white flex-shrink-0"
            style={auraStyle}>P</div>
          <div className="flex-1 min-w-0">
            <h2 className="text-xs font-semibold truncate">philip@aura.app</h2>
            <div className="flex items-center gap-2 mt-0.5">
              <span className={`text-[10px] ${darkMode ? 'text-violet-400' : 'text-violet-600'}`}>Lv.3</span>
              <span className="text-[10px] text-orange-400">üî•5</span>
              <span className={`text-[10px] ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>145 XP</span>
            </div>
          </div>
        </div>
        {/* Personality card */}
        <div className={`w-full rounded-xl overflow-hidden text-left ${
          darkMode ? 'bg-gradient-to-br from-violet-950/50 to-indigo-950/60 border border-violet-700/40'
                   : 'bg-gradient-to-br from-violet-50 to-indigo-50 border border-violet-200'
        }`}>
          <div className="flex items-stretch" style={{ minHeight: 72 }}>
            <div className={`w-[72px] flex-shrink-0 flex items-center justify-center overflow-hidden ${darkMode ? 'bg-gray-950/40' : 'bg-white/50'}`}>
              <div className="w-10 h-10 rounded-full flex items-center justify-center" style={{
                background: 'radial-gradient(circle, rgba(139,92,246,0.4), rgba(99,102,241,0.2), transparent)',
              }}>
                <span className="text-2xl">üåÄ</span>
              </div>
            </div>
            <div className="flex-1 py-2 px-3 flex flex-col justify-center min-w-0">
              <div className="flex items-center justify-between mb-0.5">
                <span className={`text-xs font-semibold truncate ${darkMode ? 'text-white' : 'text-gray-900'}`}>The Quiet Strategist</span>
                <span className={`text-[10px] flex-shrink-0 ${darkMode ? 'text-violet-400' : 'text-violet-600'}`}>‚Üí</span>
              </div>
              <p className={`text-[10px] truncate ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>Thoughtful planner, big picture</p>
              <div className="flex items-center gap-1 mt-1">
                {[1,2,3,4].map(s => (
                  <div key={s} className={`w-1.5 h-1.5 rounded-full ${s <= 2 ? (darkMode ? 'bg-violet-400' : 'bg-violet-500') : (darkMode ? 'bg-gray-700' : 'bg-gray-300')}`} />
                ))}
                <span className={`text-[9px] ml-0.5 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>Stage 2</span>
              </div>
            </div>
          </div>
        </div>
        {/* Activity stats */}
        <div className={`rounded-xl p-3 ${darkMode ? 'bg-gray-900/40 border border-gray-800/40' : 'bg-white border border-gray-200'}`}>
          <div className={`text-[9px] font-semibold uppercase tracking-wide mb-2 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>Activity</div>
          <div className="grid grid-cols-3 gap-2">
            {[['42','Answered'],['2.8','Avg Conf'],['3','Assess.']].map(([val,label],i) => (
              <div key={i} className="text-center">
                <div className={`text-lg font-bold ${darkMode ? 'text-white' : 'text-gray-900'}`}>{val}</div>
                <div className={`text-[9px] ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>{label}</div>
              </div>
            ))}
          </div>
          <div className={`mt-2 pt-2 border-t ${darkMode ? 'border-gray-800/30' : 'border-gray-200'}`}>
            <div className={`text-[9px] mb-1 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>Confidence distribution</div>
            <div className={`h-1.5 rounded-full overflow-hidden flex ${darkMode ? 'bg-gray-800/50' : 'bg-gray-200'}`}>
              <div className="h-full" style={{ width: '15%', background: '#c4b5fd' }} />
              <div className="h-full" style={{ width: '25%', background: '#a78bfa' }} />
              <div className="h-full" style={{ width: '35%', background: '#8b5cf6' }} />
              <div className="h-full" style={{ width: '25%', background: '#6d28d9' }} />
            </div>
          </div>
        </div>
        {/* Quick actions */}
        <div className="grid grid-cols-2 gap-2">
          <div className={`rounded-xl p-3 text-center ${darkMode ? 'bg-emerald-950/30 border border-emerald-800/30' : 'bg-emerald-50 border border-emerald-200'}`}>
            <span className="text-xl">üß©</span>
            <div className={`text-[10px] font-medium mt-0.5 ${darkMode ? 'text-emerald-400' : 'text-emerald-700'}`}>Assessments</div>
          </div>
          <div className={`rounded-xl p-3 text-center opacity-50 ${darkMode ? 'bg-gray-900/30 border border-gray-800/30' : 'bg-gray-100 border border-gray-200'}`}>
            <span className="text-xl grayscale">üìä</span>
            <div className={`text-[10px] font-medium mt-0.5 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>History</div>
            <div className={`text-[8px] ${darkMode ? 'text-gray-600' : 'text-gray-400'}`}>Coming soon</div>
          </div>
        </div>
      </div>
    </div>
  );
};

// ==================== SCREEN: Question of the Day ====================
const ScreenQotD = ({ darkMode }) => {
  const blueGlowStyle = {
    background: darkMode
      ? 'radial-gradient(ellipse at center top, rgba(59,130,246,0.25) 0%, rgba(59,130,246,0.12) 35%, rgba(59,130,246,0.04) 60%, transparent 80%), #030712'
      : 'radial-gradient(ellipse at center top, rgba(59,130,246,0.2) 0%, rgba(59,130,246,0.08) 35%, rgba(59,130,246,0.02) 60%, transparent 80%), #f9fafb'
  };

  return (
    <div className="flex-1 flex flex-col overflow-hidden relative" style={blueGlowStyle}>
      <div className={`h-[30px] flex-shrink-0 flex items-center gap-1.5 px-2.5 ${darkMode ? 'bg-gray-900/50' : 'bg-white/80 border-b border-gray-200'}`}>
        <span className={`text-base font-bold w-6 h-6 flex items-center justify-center ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>‚óÄ</span>
        <div className={`flex-1 h-1.5 rounded-full overflow-hidden ${darkMode ? 'bg-gray-800' : 'bg-gray-300'}`}>
          <div className="h-full bg-blue-500" style={{ width: '0%' }} />
        </div>
        <span className={`text-base font-bold w-6 h-6 flex items-center justify-center ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>‚ñ∂</span>
      </div>
      <div className={`h-[22px] flex-shrink-0 flex items-center justify-center gap-1 ${darkMode ? 'bg-blue-900/20' : 'bg-blue-50'}`}>
        <span style={{ fontSize: 10 }}>‚òÄÔ∏è</span>
        <span className={`text-[10px] font-medium ${darkMode ? 'text-blue-400' : 'text-blue-600'}`}>Question of the Day</span>
        <span className={`text-[9px] ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>Day 12</span>
        <span className="text-amber-500 text-[10px] font-medium">+25</span>
      </div>
      <div className="flex-1 flex flex-col justify-center px-3 pb-2 overflow-y-auto">
        <div className="space-y-1.5 p-3 rounded-xl" style={{ boxShadow: darkMode ? '0 0 16px rgba(59,130,246,0.16)' : 'none' }}>
          <h2 className={`text-base text-center font-medium leading-snug ${TH('text-primary', darkMode)}`}>
            Should AI systems be required to identify themselves?
          </h2>
        </div>
        <div className={`flex items-center justify-center gap-1.5 mt-2 ${darkMode ? 'text-gray-600' : 'text-gray-500'}`}>
          <span style={{ fontSize: 10 }}>üè¢</span>
          <span style={{ fontSize: 10 }}>Sponsored by TechCorp</span>
        </div>
      </div>
      <div className={`flex-shrink-0 border-t ${darkMode ? 'border-gray-800 bg-gray-950/80' : 'border-gray-200 bg-white/80'}`}>
        <div className="px-3 pt-2 h-[75px]">
          <div className="flex items-center gap-1.5">
            <div className={`flex-1 relative h-[46px] rounded-xl font-bold overflow-hidden flex items-center justify-center ${
              darkMode ? 'bg-gray-800 text-gray-300' : 'bg-white text-emerald-600 border-2 border-emerald-200'
            }`}>
              <span className="text-xl font-bold">YES</span>
            </div>
            <div className="w-9 h-[46px] flex-shrink-0" />
            <div className={`flex-1 relative h-[46px] rounded-xl font-bold overflow-hidden flex items-center justify-center ${
              darkMode ? 'bg-gray-800 text-gray-300' : 'bg-white text-rose-600 border-2 border-rose-200'
            }`}>
              <span className="text-xl font-bold">NO</span>
            </div>
          </div>
        </div>
        <div className="h-[30px]" />
      </div>
    </div>
  );
};

// ==================== SCREENS ARRAY ====================
const SECTIONS = {
  Auth:        { color: '#6366f1', glow: 'rgba(99, 102, 241, 0.12)',  label: 'Auth',        icon: 'üîê' },
  Onboarding:  { color: '#8b5cf6', glow: 'rgba(139, 92, 246, 0.12)',  label: 'Onboarding',  icon: 'üöÄ' },
  Main:        { color: '#3b82f6', glow: 'rgba(59, 130, 246, 0.12)',  label: 'Main',        icon: 'üè†' },
  Questions:   { color: '#14b8a6', glow: 'rgba(20, 184, 166, 0.12)', label: 'Questions',   icon: '‚ùì' },
  Settings:    { color: '#64748b', glow: 'rgba(100, 116, 139, 0.12)', label: 'Settings',    icon: '‚öôÔ∏è' },
  Assessments: { color: '#f59e0b', glow: 'rgba(245, 158, 11, 0.12)', label: 'Assessments', icon: 'üìä' },
  Modals:      { color: '#ec4899', glow: 'rgba(236, 72, 153, 0.12)', label: 'Modals',      icon: 'üí¨' },
};

const SCREENS = [
  { id: 'welcome',            name: 'Welcome',             section: 'Auth',        component: ScreenWelcome },
  { id: 'sign-in',            name: 'Sign In',             section: 'Auth',        component: ScreenSignIn },
  { id: 'onboarding',         name: 'Onboarding',          section: 'Onboarding',  component: ScreenOnboarding },
  { id: 'path-choice',        name: 'Path Choice',         section: 'Onboarding',  component: ScreenPathChoice },
  { id: 'categories',         name: 'Categories',          section: 'Main',        component: ScreenCategories },
  { id: 'profile',            name: 'Profile',             section: 'Main',        component: ScreenProfile },
  { id: 'qotd',               name: 'Question of the Day', section: 'Questions',   component: ScreenQotD },
  { id: 'binary-question',    name: 'Binary Question',     section: 'Questions',   component: ScreenBinaryQuestion },
  { id: 'mc-question',        name: 'MC Question',         section: 'Questions',   component: ScreenMCQuestion },
  { id: 'results',            name: 'Results',             section: 'Questions',   component: ScreenResults },
  { id: 'settings',           name: 'Settings',            section: 'Settings',    component: ScreenSettings },
  { id: 'assessments',        name: 'Assessments',         section: 'Assessments', component: ScreenAssessments },
  { id: 'assessment-taking',  name: 'Assessment Taking',   section: 'Assessments', component: ScreenAssessmentTaking },
  { id: 'assessment-results', name: 'Assessment Results',  section: 'Assessments', component: ScreenAssessmentResults },
  { id: 'save-modal',         name: 'Save Modal',          section: 'Modals',      component: ScreenSaveModal },
  { id: 'level-up',           name: 'Level Up',            section: 'Modals',      component: ScreenLevelUp },
];

// ==================== GLASS DASHBOARD APP ====================
const App = () => {
  const [darkMode, setDarkMode] = useState(true);
  const [search, setSearch] = useState('');
  const [activeSection, setActiveSection] = useState(null);
  const [expandedId, setExpandedId] = useState(null);
  const [focusIdx, setFocusIdx] = useState(-1);
  const gridRef = useRef(null);
  const cardRefs = useRef({});

  // Filtered screens
  const filtered = useMemo(() => {
    return SCREENS.filter(s => {
      const matchSearch = !search || s.name.toLowerCase().includes(search.toLowerCase());
      const matchSection = !activeSection || s.section === activeSection;
      return matchSearch && matchSection;
    });
  }, [search, activeSection]);

  // Section counts
  const sectionCounts = useMemo(() => {
    const counts = {};
    SCREENS.forEach(s => { counts[s.section] = (counts[s.section] || 0) + 1; });
    return counts;
  }, []);

  // Keyboard navigation
  useEffect(() => {
    const handler = (e) => {
      if (expandedId) {
        if (e.key === 'Escape') { setExpandedId(null); e.preventDefault(); }
        if (e.key === 'ArrowLeft') {
          const idx = SCREENS.findIndex(s => s.id === expandedId);
          if (idx > 0) { setExpandedId(SCREENS[idx - 1].id); e.preventDefault(); }
        }
        if (e.key === 'ArrowRight') {
          const idx = SCREENS.findIndex(s => s.id === expandedId);
          if (idx < SCREENS.length - 1) { setExpandedId(SCREENS[idx + 1].id); e.preventDefault(); }
        }
        return;
      }
      const cols = window.innerWidth >= 1536 ? 5 : window.innerWidth >= 1280 ? 4 : window.innerWidth >= 768 ? 3 : 2;
      if (e.key === 'ArrowRight') { setFocusIdx(i => Math.min(i + 1, filtered.length - 1)); e.preventDefault(); }
      else if (e.key === 'ArrowLeft') { setFocusIdx(i => Math.max(i - 1, 0)); e.preventDefault(); }
      else if (e.key === 'ArrowDown') { setFocusIdx(i => Math.min(i + cols, filtered.length - 1)); e.preventDefault(); }
      else if (e.key === 'ArrowUp') { setFocusIdx(i => Math.max(i - cols, 0)); e.preventDefault(); }
      else if (e.key === 'Enter' && focusIdx >= 0) { setExpandedId(filtered[focusIdx].id); e.preventDefault(); }
    };
    window.addEventListener('keydown', handler);
    return () => window.removeEventListener('keydown', handler);
  }, [expandedId, filtered, focusIdx]);

  // Scroll focused card into view
  useEffect(() => {
    if (focusIdx >= 0 && filtered[focusIdx]) {
      const el = cardRefs.current[filtered[focusIdx].id];
      if (el) el.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
    }
  }, [focusIdx, filtered]);

  // Reset focus when filter changes
  useEffect(() => { setFocusIdx(-1); }, [search, activeSection]);

  const expandedScreen = expandedId ? SCREENS.find(s => s.id === expandedId) : null;

  // Glass helper: frosted glass panels
  const glass = (opacity = 0.08, blur = 16) => ({
    background: darkMode
      ? `rgba(255, 255, 255, ${opacity})`
      : `rgba(255, 255, 255, ${Math.min(opacity * 8, 0.72)})`,
    backdropFilter: `blur(${blur}px)${darkMode ? '' : ' saturate(1.5)'}`,
    WebkitBackdropFilter: `blur(${blur}px)${darkMode ? '' : ' saturate(1.5)'}`,
    border: `1px solid ${darkMode ? `rgba(255,255,255,${opacity + 0.02})` : 'rgba(255,255,255,0.6)'}`,
    boxShadow: darkMode ? 'none' : '0 2px 12px rgba(0,0,0,0.03), inset 0 1px 0 rgba(255,255,255,0.7)',
  });

  // Background gradient
  const bgStyle = darkMode
    ? { background: 'linear-gradient(135deg, #0c1222 0%, #111b33 35%, #0f172a 65%, #0a0f1a 100%)', minHeight: '100vh' }
    : { background: 'linear-gradient(135deg, #e8edf5 0%, #dce4f0 30%, #d5dff0 50%, #e2e9f4 70%, #eef2f9 100%)', minHeight: '100vh' };

  // Phone frame glass styling for light mode
  const phoneFrameStyle = (secColor, secGlow) => ({
    borderRadius: 20,
    overflow: 'hidden',
    height: 280,
    position: 'relative',
    boxShadow: darkMode
      ? `inset 0 0 30px ${secGlow}`
      : `inset 0 0 20px rgba(0,0,0,0.04), 0 1px 3px rgba(0,0,0,0.06)`,
  });

  return (
    <div style={bgStyle} className="relative">
      {/* Background gradient orbs */}
      <div style={{ position: 'fixed', inset: 0, pointerEvents: 'none', overflow: 'hidden', zIndex: 0 }}>
        <div style={{ position: 'absolute', top: '-10%', right: '-5%', width: '40vw', height: '40vw', borderRadius: '50%',
          background: darkMode ? 'radial-gradient(circle, rgba(99,102,241,0.08) 0%, transparent 70%)' : 'radial-gradient(circle, rgba(99,102,241,0.05) 0%, transparent 70%)' }} />
        <div style={{ position: 'absolute', bottom: '-10%', left: '-5%', width: '50vw', height: '50vw', borderRadius: '50%',
          background: darkMode ? 'radial-gradient(circle, rgba(14,165,233,0.06) 0%, transparent 70%)' : 'radial-gradient(circle, rgba(14,165,233,0.04) 0%, transparent 70%)' }} />
        <div style={{ position: 'absolute', top: '40%', left: '30%', width: '30vw', height: '30vw', borderRadius: '50%',
          background: darkMode ? 'radial-gradient(circle, rgba(139,92,246,0.05) 0%, transparent 70%)' : 'radial-gradient(circle, rgba(139,92,246,0.03) 0%, transparent 70%)' }} />
      </div>

      {/* ===== TOP BAR ===== */}
      <div className="sticky top-0 z-40" style={{ ...glass(0.06, 20), borderTop: 'none', borderLeft: 'none', borderRight: 'none',
        borderBottom: `1px solid ${darkMode ? 'rgba(255,255,255,0.06)' : 'rgba(0,0,0,0.06)'}` }}>
        <div className="max-w-[1800px] mx-auto px-6 py-4">
          {/* Title row */}
          <div className="flex items-center justify-between mb-3">
            <div className="flex items-center gap-4">
              <h1 className={`text-2xl font-bold tracking-tight ${darkMode ? 'text-white' : 'text-gray-900'}`}>
                Aura Screen Atlas
              </h1>
              <div className="flex items-center gap-3">
                <span className={`text-sm font-medium px-3 py-1 rounded-full`}
                  style={glass(0.04, 8)}>
                  <span className={darkMode ? 'text-gray-400' : 'text-gray-600'}>{filtered.length} / {SCREENS.length} screens</span>
                </span>
                <span className={`text-sm font-medium px-3 py-1 rounded-full`}
                  style={glass(0.04, 8)}>
                  <span className={darkMode ? 'text-gray-400' : 'text-gray-600'}>{Object.keys(SECTIONS).length} sections</span>
                </span>
              </div>
            </div>
            {/* Dark/light toggle */}
            <button
              onClick={() => setDarkMode(d => !d)}
              className="w-10 h-10 rounded-xl flex items-center justify-center text-lg transition-all"
              style={{
                ...glass(darkMode ? 0.08 : 0.5, 8),
                color: darkMode ? '#fde047' : '#4b5563',
              }}
              title="Toggle dark/light mode"
            >
              {darkMode ? '‚òÄÔ∏è' : 'üåô'}
            </button>
          </div>

          {/* Search bar */}
          <div className="flex items-center gap-3 mb-3">
            <div className="relative flex-1 max-w-md">
              <span className="absolute left-3 top-1/2 -translate-y-1/2 text-sm pointer-events-none" style={{ color: darkMode ? '#6b7280' : '#9ca3af' }}>üîç</span>
              <input
                type="text"
                placeholder="Search screens..."
                value={search}
                onChange={e => setSearch(e.target.value)}
                className="w-full pl-9 pr-4 py-2 rounded-xl text-sm outline-none transition-all"
                style={{
                  ...glass(darkMode ? 0.05 : 0.6, 12),
                  color: darkMode ? '#fff' : '#111827',
                }}
              />
              {search && (
                <button onClick={() => setSearch('')}
                  className="absolute right-3 top-1/2 -translate-y-1/2 text-xs rounded-full w-5 h-5 flex items-center justify-center"
                  style={{ ...glass(0.1, 4), color: darkMode ? '#9ca3af' : '#6b7280' }}>
                  ‚úï
                </button>
              )}
            </div>
            <span className={`text-xs hidden md:inline ${darkMode ? 'text-gray-600' : 'text-gray-400'}`}>
              ‚Üê ‚Üí ‚Üë ‚Üì navigate ¬∑ Enter expand ¬∑ Esc close
            </span>
          </div>

          {/* Section filter chips */}
          <div className="flex items-center gap-2 flex-wrap">
            <button
              onClick={() => setActiveSection(null)}
              className="px-3 py-1.5 rounded-lg text-xs font-semibold transition-all"
              style={{
                ...glass(!activeSection ? 0.15 : 0.05, 6),
                color: !activeSection ? (darkMode ? '#fff' : '#111827') : (darkMode ? '#9ca3af' : '#6b7280'),
                boxShadow: !activeSection ? (darkMode ? '0 0 12px rgba(255,255,255,0.05)' : '0 0 12px rgba(0,0,0,0.04)') : 'none',
              }}
            >
              All
            </button>
            {Object.entries(SECTIONS).map(([key, sec]) => {
              const isActive = activeSection === key;
              return (
                <button
                  key={key}
                  onClick={() => setActiveSection(activeSection === key ? null : key)}
                  className="px-3 py-1.5 rounded-lg text-xs font-semibold transition-all flex items-center gap-1.5"
                  style={{
                    background: isActive
                      ? `${sec.color}${darkMode ? '33' : '22'}`
                      : (darkMode ? 'rgba(255,255,255,0.04)' : 'rgba(255,255,255,0.5)'),
                    backdropFilter: 'blur(6px)',
                    border: isActive ? `1px solid ${sec.color}55` : `1px solid ${darkMode ? 'rgba(255,255,255,0.06)' : 'rgba(0,0,0,0.06)'}`,
                    color: isActive ? (darkMode ? '#fff' : sec.color) : (darkMode ? '#9ca3af' : '#6b7280'),
                    boxShadow: isActive ? `0 0 12px ${sec.glow}` : (darkMode ? 'none' : '0 1px 3px rgba(0,0,0,0.03)'),
                  }}
                >
                  <span>{sec.icon}</span>
                  <span>{sec.label}</span>
                  <span style={{ fontSize: 10, opacity: 0.6 }}>{sectionCounts[key]}</span>
                </button>
              );
            })}
          </div>
        </div>
      </div>

      {/* ===== SCREEN GRID ===== */}
      <div className="max-w-[1800px] mx-auto px-6 py-8 relative z-10" ref={gridRef}>
        {(() => {
          const sections = [];
          let currentSection = null;
          let currentScreens = [];

          filtered.forEach((screen, idx) => {
            if (screen.section !== currentSection) {
              if (currentSection) sections.push({ section: currentSection, screens: currentScreens });
              currentSection = screen.section;
              currentScreens = [];
            }
            currentScreens.push({ ...screen, globalIdx: idx });
          });
          if (currentSection) sections.push({ section: currentSection, screens: currentScreens });

          return sections.map(({ section, screens }) => {
            const sec = SECTIONS[section];
            return (
              <div key={section} className="mb-10">
                {/* Section header */}
                <div className="flex items-center gap-3 mb-5 px-1">
                  <div className="w-8 h-8 rounded-lg flex items-center justify-center text-base"
                    style={{
                      background: `${sec.color}${darkMode ? '22' : '18'}`,
                      boxShadow: `0 0 16px ${sec.glow}`,
                      border: darkMode ? 'none' : `1px solid ${sec.color}22`,
                    }}>
                    {sec.icon}
                  </div>
                  <h2 className={`text-lg font-bold tracking-tight ${darkMode ? 'text-white' : 'text-gray-900'}`}>
                    {sec.label}
                  </h2>
                  <span className="text-xs px-2 py-0.5 rounded-full"
                    style={glass(0.04, 6)}>
                    <span className={darkMode ? 'text-gray-500' : 'text-gray-500'}>{screens.length}</span>
                  </span>
                  <div className={`flex-1 h-px ${darkMode ? 'bg-white/5' : 'bg-gray-300/40'}`} />
                </div>

                {/* Cards grid */}
                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 2xl:grid-cols-5 gap-5">
                  {screens.map(screen => {
                    const isFocused = focusIdx === screen.globalIdx;
                    const Comp = screen.component;
                    return (
                      <div
                        key={screen.id}
                        ref={el => cardRefs.current[screen.id] = el}
                        onClick={() => setExpandedId(screen.id)}
                        className="group cursor-pointer"
                        style={{ outline: 'none' }}
                      >
                        <div
                          className="rounded-2xl overflow-hidden transition-all duration-200"
                          style={{
                            ...glass(darkMode ? 0.06 : 0.55, 12),
                            padding: '10px',
                            transform: isFocused ? 'translateY(-4px) scale(1.01)' : 'translateY(0)',
                            boxShadow: isFocused
                              ? `0 8px 32px rgba(0,0,0,${darkMode ? 0.3 : 0.12}), 0 0 0 2px ${sec.color}55, 0 0 20px ${sec.glow}`
                              : `0 4px 16px rgba(0,0,0,${darkMode ? 0.2 : 0.06})${darkMode ? '' : ', inset 0 1px 0 rgba(255,255,255,0.6)'}`,
                          }}
                        >
                          {/* Mini phone preview with Dynamic Island */}
                          <div className="rounded-xl overflow-hidden" style={{
                            height: 280, position: 'relative',
                            boxShadow: darkMode ? `inset 0 0 30px ${sec.glow}` : 'inset 0 0 20px rgba(0,0,0,0.03)',
                            border: darkMode ? 'none' : '1px solid rgba(0,0,0,0.04)',
                            borderRadius: 16,
                          }}>
                            <div style={{
                              transform: 'scale(0.32)',
                              transformOrigin: 'top left',
                              width: 393, height: 852,
                              position: 'absolute', top: 0, left: 0,
                              pointerEvents: 'none',
                            }}>
                              <PhoneChrome darkMode={darkMode} scale={1}>
                                <Comp darkMode={darkMode} />
                              </PhoneChrome>
                            </div>
                          </div>

                          {/* Label */}
                          <div className="mt-2 px-1 flex items-center justify-between">
                            <span className={`text-xs font-semibold truncate ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                              {screen.name}
                            </span>
                            <span className="text-[10px] rounded-full px-1.5 py-0.5 font-medium flex-shrink-0 ml-1"
                              style={{
                                background: `${sec.color}${darkMode ? '22' : '15'}`,
                                color: darkMode ? sec.color : sec.color,
                                border: darkMode ? 'none' : `1px solid ${sec.color}22`,
                              }}>
                              {sec.label}
                            </span>
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            );
          });
        })()}

        {/* Empty state */}
        {filtered.length === 0 && (
          <div className="flex flex-col items-center justify-center py-24 gap-3">
            <span className="text-4xl opacity-40">üîç</span>
            <p className={`text-lg font-medium ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>No screens match your filter</p>
            <button onClick={() => { setSearch(''); setActiveSection(null); }}
              className="text-sm px-4 py-2 rounded-lg transition-all"
              style={glass(0.1, 8)}>
              <span className={darkMode ? 'text-gray-300' : 'text-gray-600'}>Clear filters</span>
            </button>
          </div>
        )}
      </div>

      {/* ===== EXPANDED OVERLAY ===== */}
      {expandedScreen && (() => {
        const sec = SECTIONS[expandedScreen.section];
        const Comp = expandedScreen.component;
        const currentIdx = SCREENS.findIndex(s => s.id === expandedId);
        const prev = currentIdx > 0 ? SCREENS[currentIdx - 1] : null;
        const next = currentIdx < SCREENS.length - 1 ? SCREENS[currentIdx + 1] : null;

        return (
          <div
            className="fixed inset-0 z-50 flex items-center justify-center glass-overlay-enter"
            style={{
              background: darkMode ? 'rgba(0,0,0,0.75)' : 'rgba(0,0,0,0.4)',
              backdropFilter: 'blur(16px)',
              WebkitBackdropFilter: 'blur(16px)',
            }}
            onClick={(e) => { if (e.target === e.currentTarget) setExpandedId(null); }}
          >
            {/* Close button */}
            <button
              onClick={() => setExpandedId(null)}
              className="absolute top-6 right-6 w-10 h-10 rounded-xl flex items-center justify-center text-lg transition-all"
              style={{
                ...glass(darkMode ? 0.1 : 0.7, 8),
                color: darkMode ? '#d1d5db' : '#4b5563',
              }}
            >
              ‚úï
            </button>

            {/* Prev nav */}
            {prev && (
              <button
                onClick={(e) => { e.stopPropagation(); setExpandedId(prev.id); }}
                className="absolute left-6 top-1/2 -translate-y-1/2 w-12 h-12 rounded-xl flex items-center justify-center text-xl transition-all"
                style={{
                  ...glass(darkMode ? 0.1 : 0.7, 8),
                  color: darkMode ? '#d1d5db' : '#4b5563',
                }}
              >
                ‚Äπ
              </button>
            )}
            {/* Next nav */}
            {next && (
              <button
                onClick={(e) => { e.stopPropagation(); setExpandedId(next.id); }}
                className="absolute right-6 top-1/2 -translate-y-1/2 w-12 h-12 rounded-xl flex items-center justify-center text-xl transition-all"
                style={{
                  ...glass(darkMode ? 0.1 : 0.7, 8),
                  color: darkMode ? '#d1d5db' : '#4b5563',
                }}
              >
                ‚Ä∫
              </button>
            )}

            <div className="flex flex-col items-center gap-4 glass-modal-enter" onClick={e => e.stopPropagation()}>
              {/* Screen label */}
              <div className="flex items-center gap-3">
                <span className={`text-xl font-bold ${darkMode ? 'text-white' : 'text-gray-900'}`}>
                  {expandedScreen.name}
                </span>
                <span className="text-sm px-2.5 py-1 rounded-full font-medium"
                  style={{
                    background: `${sec.color}${darkMode ? '22' : '15'}`,
                    color: sec.color,
                    border: `1px solid ${sec.color}33`,
                  }}>
                  {sec.icon} {sec.label}
                </span>
                <span className={`text-sm ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>
                  {currentIdx + 1} / {SCREENS.length}
                </span>
              </div>

              {/* Device frame ‚Äî frosted glass border in both modes */}
              <div style={{
                borderRadius: 52,
                padding: 6,
                background: darkMode
                  ? 'linear-gradient(145deg, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0.02) 100%)'
                  : 'linear-gradient(145deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.7) 100%)',
                boxShadow: darkMode
                  ? `0 25px 60px rgba(0,0,0,0.5), 0 8px 24px rgba(0,0,0,0.3), 0 0 40px ${sec.glow}, inset 0 1px 0 rgba(255,255,255,0.08)`
                  : `0 25px 60px rgba(0,0,0,0.12), 0 8px 24px rgba(0,0,0,0.06), 0 0 40px ${sec.glow}, inset 0 1px 0 rgba(255,255,255,0.9)`,
                border: darkMode ? 'none' : '1px solid rgba(255,255,255,0.7)',
              }}>
                <PhoneChrome darkMode={darkMode} scale={1}>
                  <Comp darkMode={darkMode} />
                </PhoneChrome>
              </div>

              {/* Keyboard hint */}
              <div className={`text-xs ${darkMode ? 'text-gray-600' : 'text-gray-400'}`}>
                Esc to close ¬∑ ‚Üê ‚Üí to navigate
              </div>
            </div>
          </div>
        );
      })()}
    </div>
  );
};

// ==================== MOUNT ====================
ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>
</body>
</html>
