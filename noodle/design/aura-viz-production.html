<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AuraVisualization — Production Candidate</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body, #root { height: 100%; margin: 0; }
    * { box-sizing: border-box; font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; }
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

    /* Breathing keyframes for CSS-driven pulse */
    @keyframes aura-breathe {
      0%, 100% { transform: scale(0.94); opacity: 0.85; }
      50% { transform: scale(1.06); opacity: 1; }
    }
    @keyframes aura-breathe-slow {
      0%, 100% { transform: scale(0.97); }
      50% { transform: scale(1.03); }
    }
    @keyframes star-twinkle {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 0.8; }
    }
    @keyframes wave-ring {
      0% { transform: scale(0.4); opacity: 0; }
      10% { opacity: var(--wave-opacity, 0.25); }
      70% { opacity: calc(var(--wave-opacity, 0.25) * 0.2); }
      100% { transform: scale(1.4); opacity: 0; }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, useMemo } = React;

    // ==================== PRODUCTION TOKENS ====================
    const COLOR_HEX = {
      violet: { base: '#8b5cf6' },
      blue:   { base: '#3b82f6' },
      emerald:{ base: '#10b981' },
      pink:   { base: '#d946ef' },
      cyan:   { base: '#06b6d4' },
      teal:   { base: '#14b8a6' },
      amber:  { base: '#f59e0b' },
      rose:   { base: '#f43f5e' },
    };

    // ==================== HELPER ====================
    const hexToRgba = (hex, alpha) => {
      const r = parseInt(hex.slice(1,3), 16);
      const g = parseInt(hex.slice(3,5), 16);
      const b = parseInt(hex.slice(5,7), 16);
      return `rgba(${r},${g},${b},${alpha})`;
    };

    // ==================== AURA VISUALIZATION ====================
    // Drop-in replacement: same props { stage, darkMode }
    const AuraVisualization = ({ stage, darkMode }) => {
      const [time, setTime] = useState(0);
      const animRef = useRef();
      const containerRef = useRef();

      const violet = COLOR_HEX.violet.base;
      const blue = COLOR_HEX.blue.base;
      const emerald = COLOR_HEX.emerald.base;
      const pink = COLOR_HEX.pink.base;
      const cyan = COLOR_HEX.cyan.base;

      // ---- GLOW ELLIPSES: distinct color zones per stage ----
      // Each has its own region — NOT overlapping into mush
      const auraData = {
        1: [
          { cx: 100, cy: 80, rx: 55, ry: 45, color: violet, opacity: 0.7 },
          { cx: 100, cy: 130, rx: 50, ry: 40, color: blue, opacity: 0.55 },
        ],
        2: [
          { cx: 85, cy: 70, rx: 60, ry: 50, color: violet, opacity: 0.75 },
          { cx: 70, cy: 135, rx: 50, ry: 45, color: blue, opacity: 0.6 },
          { cx: 140, cy: 115, rx: 55, ry: 50, color: emerald, opacity: 0.65 },
        ],
        3: [
          { cx: 90, cy: 60, rx: 65, ry: 50, color: violet, opacity: 0.8 },
          { cx: 55, cy: 130, rx: 50, ry: 50, color: blue, opacity: 0.65 },
          { cx: 150, cy: 95, rx: 55, ry: 55, color: emerald, opacity: 0.7 },
          { cx: 110, cy: 155, rx: 60, ry: 45, color: pink, opacity: 0.7 },
        ],
        4: [
          { cx: 85, cy: 50, rx: 70, ry: 55, color: violet, opacity: 0.85 },
          { cx: 40, cy: 110, rx: 55, ry: 60, color: cyan, opacity: 0.75 },
          { cx: 160, cy: 85, rx: 60, ry: 60, color: emerald, opacity: 0.8 },
          { cx: 120, cy: 160, rx: 65, ry: 50, color: pink, opacity: 0.8 },
          { cx: 100, cy: 105, rx: 40, ry: 40, color: blue, opacity: 0.5 },
        ],
      }[stage] || [];

      // ---- NEURON POSITIONS per stage ----
      const baseNeurons = {
        1: [
          { x: 100, y: 95, r: 4.5, color: violet },
          { x: 82, y: 75, r: 3.5, color: violet },
          { x: 118, y: 82, r: 3.5, color: blue },
          { x: 92, y: 115, r: 3, color: blue },
        ],
        2: [
          { x: 100, y: 95, r: 5, color: violet },
          { x: 72, y: 70, r: 4, color: violet },
          { x: 130, y: 78, r: 4, color: emerald },
          { x: 82, y: 125, r: 4, color: blue },
          { x: 120, y: 115, r: 3.5, color: emerald },
        ],
        3: [
          { x: 100, y: 100, r: 6, color: violet },
          { x: 60, y: 56, r: 5, color: violet },
          { x: 145, y: 70, r: 5, color: emerald },
          { x: 158, y: 110, r: 4, color: emerald },
          { x: 42, y: 95, r: 5, color: blue },
          { x: 75, y: 148, r: 5, color: pink },
          { x: 130, y: 140, r: 5, color: pink },
          { x: 92, y: 66, r: 4, color: violet },
          { x: 65, y: 118, r: 4, color: blue },
          { x: 140, y: 98, r: 3.5, color: emerald },
        ],
        4: [
          { x: 100, y: 98, r: 6, color: violet },
          { x: 55, y: 50, r: 5, color: violet },
          { x: 140, y: 46, r: 4.5, color: violet },
          { x: 158, y: 82, r: 5, color: emerald },
          { x: 150, y: 128, r: 4, color: pink },
          { x: 40, y: 85, r: 5, color: cyan },
          { x: 48, y: 138, r: 5, color: cyan },
          { x: 118, y: 150, r: 5, color: pink },
          { x: 70, y: 150, r: 4, color: pink },
          { x: 82, y: 62, r: 4, color: violet },
          { x: 128, y: 70, r: 4, color: emerald },
          { x: 62, y: 108, r: 3.5, color: cyan },
          { x: 138, y: 108, r: 3.5, color: emerald },
        ],
      }[stage] || [];

      // ---- CONNECTION INDICES ----
      const connectionIndices = {
        1: [[0,1],[0,2],[0,3],[1,2],[2,3]],
        2: [[0,1],[0,2],[0,3],[0,4],[1,3],[2,4],[1,2]],
        3: [[0,1],[0,2],[0,3],[0,4],[0,5],[0,6],[0,7],[0,8],[0,9],[1,7],[2,7],[2,9],[3,9],[3,6],[4,8],[4,5],[5,6],[1,4]],
        4: [[0,1],[0,2],[0,3],[0,4],[0,5],[0,6],[0,7],[0,8],[0,9],[0,10],[0,11],[0,12],[1,9],[2,10],[3,10],[3,12],[4,12],[4,7],[5,11],[5,6],[6,8],[8,7],[1,5],[2,3]],
      }[stage] || [];

      // ---- BACKGROUND STARS (subtle twinkle) ----
      const stars = useMemo(() => {
        const rng = (seed) => {
          let s = seed;
          return () => { s = (s * 16807 + 0) % 2147483647; return s / 2147483647; };
        };
        const r = rng(stage * 7 + 42);
        const count = 12 + stage * 4;
        return Array.from({ length: count }, (_, i) => ({
          cx: r() * 200,
          cy: r() * 220,
          r: 0.4 + r() * 0.8,
          delay: r() * 6,
          duration: 3 + r() * 4,
        }));
      }, [stage]);

      // ---- ANIMATION LOOP ----
      useEffect(() => {
        const animate = () => {
          setTime(t => t + 0.02);
          animRef.current = requestAnimationFrame(animate);
        };
        animRef.current = requestAnimationFrame(animate);
        return () => cancelAnimationFrame(animRef.current);
      }, []);

      // ---- ANIMATED NEURONS ----
      const animatedNeurons = baseNeurons.map((n, i) => {
        const speed = 0.4 + (i % 3) * 0.25;
        const amp = 1.8 + (i % 4) * 0.6;
        const phaseX = i * 1.3;
        const phaseY = i * 0.9 + 0.5;
        return {
          ...n,
          x: n.x + Math.sin(time * speed + phaseX) * amp,
          y: n.y + Math.cos(time * speed * 0.75 + phaseY) * amp,
        };
      });

      // ---- SIZING: grows with stage ----
      const sizes = { 1: 110, 2: 130, 3: 160, 4: 190 };
      const size = sizes[stage] || 130;

      // ---- COLORS ----
      const lineColor = darkMode ? 'rgba(255,255,255,' : 'rgba(100,100,120,';
      const lineBaseOpacity = darkMode ? 0.3 : 0.18;
      const starColor = darkMode ? 'rgba(255,255,255,' : 'rgba(140,140,160,';

      // ---- SVG FILTERS ----
      const blurId = `aura-glow-${stage}`;
      const softBlurId = `aura-soft-${stage}`;
      // Main glow: moderate blur so colors stay distinct
      const blurAmount = { 1: 14, 2: 16, 3: 18, 4: 20 }[stage] || 16;
      // Node halo: subtle
      const nodeBlurAmount = { 1: 6, 2: 7, 3: 8, 4: 10 }[stage] || 8;

      // Breathing transform (CSS-driven for smooth performance)
      const breatheStyle = {
        animation: `aura-breathe ${10 + stage}s ease-in-out infinite`,
        transformOrigin: 'center center',
      };

      return (
        <div
          ref={containerRef}
          className="flex items-center justify-center"
          style={{ width: size, height: size * 1.1, margin: '0 auto', position: 'relative' }}
        >
          <svg
            width={size}
            height={size * 1.1}
            viewBox="0 0 200 220"
            style={{ overflow: 'visible' }}
          >
            <defs>
              {/* Main glow blur — enough to soften, not enough to destroy color identity */}
              <filter id={blurId} x="-80%" y="-80%" width="260%" height="260%">
                <feGaussianBlur in="SourceGraphic" stdDeviation={blurAmount} />
              </filter>

              {/* Softer blur for node halos */}
              <filter id={softBlurId} x="-200%" y="-200%" width="500%" height="500%">
                <feGaussianBlur in="SourceGraphic" stdDeviation={nodeBlurAmount} />
              </filter>

              {/* Radial fade mask — soft edges, no hard boundary */}
              <radialGradient id={`aura-fade-${stage}`} cx="50%" cy="50%" r="50%">
                <stop offset="0%" stopColor="white" stopOpacity="1" />
                <stop offset="55%" stopColor="white" stopOpacity="1" />
                <stop offset="80%" stopColor="white" stopOpacity="0.6" />
                <stop offset="100%" stopColor="white" stopOpacity="0" />
              </radialGradient>
              <mask id={`aura-mask-${stage}`}>
                <rect x="-50" y="-30" width="300" height="280" fill={`url(#aura-fade-${stage})`} />
              </mask>
            </defs>

            {/* Background stars */}
            {stars.map((s, i) => (
              <circle
                key={`star-${i}`}
                cx={s.cx}
                cy={s.cy}
                r={s.r}
                fill={`${starColor}0.5)`}
                style={{
                  animation: `star-twinkle ${s.duration}s ease-in-out ${s.delay}s infinite`,
                }}
              />
            ))}

            {/* Glow layer — masked for soft edges */}
            <g mask={`url(#aura-mask-${stage})`} style={breatheStyle}>
              <g filter={`url(#${blurId})`}>
                {auraData.map((e, i) => (
                  <ellipse
                    key={i}
                    cx={e.cx}
                    cy={e.cy}
                    rx={e.rx}
                    ry={e.ry}
                    fill={e.color}
                    opacity={darkMode ? e.opacity : e.opacity * 0.6}
                  />
                ))}
              </g>
            </g>

            {/* Connection lines — visible but delicate */}
            <g style={breatheStyle}>
              {connectionIndices.map(([from, to], i) => {
                const a = animatedNeurons[from];
                const b = animatedNeurons[to];
                if (!a || !b) return null;
                // Fade by distance
                const dx = a.x - b.x;
                const dy = a.y - b.y;
                const dist = Math.sqrt(dx*dx + dy*dy);
                const maxDist = 120;
                const opacity = Math.max(0, (1 - dist / maxDist)) * lineBaseOpacity;
                return (
                  <line
                    key={i}
                    x1={a.x} y1={a.y}
                    x2={b.x} y2={b.y}
                    stroke={`${lineColor}${opacity})`}
                    strokeWidth="1"
                    strokeLinecap="round"
                  />
                );
              })}
            </g>

            {/* Neural nodes with glow halos */}
            <g style={breatheStyle}>
              {animatedNeurons.map((n, i) => (
                <g key={i}>
                  {/* Outer glow halo */}
                  <circle
                    cx={n.x} cy={n.y}
                    r={n.r * 3}
                    fill={hexToRgba(n.color, darkMode ? 0.2 : 0.12)}
                    filter={`url(#${softBlurId})`}
                  />
                  {/* Mid glow */}
                  <circle
                    cx={n.x} cy={n.y}
                    r={n.r * 1.8}
                    fill={hexToRgba(n.color, darkMode ? 0.35 : 0.2)}
                  />
                  {/* Core dot */}
                  <circle
                    cx={n.x} cy={n.y}
                    r={n.r}
                    fill={n.color}
                    opacity={darkMode ? 0.95 : 0.8}
                  />
                  {/* Bright center pip */}
                  <circle
                    cx={n.x} cy={n.y}
                    r={n.r * 0.4}
                    fill="white"
                    opacity={darkMode ? 0.6 : 0.4}
                  />
                </g>
              ))}
            </g>
          </svg>
        </div>
      );
    };

    // ==================== DEMO HARNESS ====================
    const App = () => {
      const [stage, setStage] = useState(4);
      const [darkMode, setDarkMode] = useState(true);

      const bg = darkMode ? '#030712' : '#f9fafb';
      const cardBg = darkMode ? '#111827' : '#ffffff';
      const textPrimary = darkMode ? '#f9fafb' : '#111827';
      const textMuted = darkMode ? '#6b7280' : '#9ca3af';
      const borderColor = darkMode ? '#1f2937' : '#e5e7eb';

      return (
        <div style={{ background: bg, minHeight: '100vh', padding: 40, transition: 'background 0.4s ease' }}>
          <div style={{ maxWidth: 800, margin: '0 auto' }}>
            {/* Title */}
            <h1 style={{ color: textPrimary, fontSize: 24, fontWeight: 600, marginBottom: 8, textAlign: 'center' }}>
              AuraVisualization — Production Candidate
            </h1>
            <p style={{ color: textMuted, fontSize: 14, marginBottom: 32, textAlign: 'center' }}>
              Drop-in replacement for index.html. Same props: {'{ stage, darkMode }'}
            </p>

            {/* Controls */}
            <div style={{ display: 'flex', gap: 12, justifyContent: 'center', marginBottom: 32 }}>
              {[1,2,3,4].map(s => (
                <button
                  key={s}
                  onClick={() => setStage(s)}
                  style={{
                    padding: '8px 20px', borderRadius: 8, fontSize: 13, fontWeight: 500, cursor: 'pointer',
                    border: 'none',
                    background: s === stage ? '#8b5cf6' : (darkMode ? 'rgba(255,255,255,0.08)' : 'rgba(0,0,0,0.06)'),
                    color: s === stage ? 'white' : (darkMode ? 'rgba(255,255,255,0.6)' : 'rgba(0,0,0,0.6)'),
                    transition: 'all 0.2s ease',
                  }}
                >
                  Stage {s}
                </button>
              ))}
              <button
                onClick={() => setDarkMode(!darkMode)}
                style={{
                  padding: '8px 20px', borderRadius: 8, fontSize: 13, fontWeight: 500, cursor: 'pointer',
                  border: `1px solid ${borderColor}`,
                  background: 'transparent',
                  color: darkMode ? 'rgba(255,255,255,0.6)' : 'rgba(0,0,0,0.6)',
                  transition: 'all 0.2s ease',
                }}
              >
                {darkMode ? 'Light' : 'Dark'}
              </button>
            </div>

            {/* Side-by-side: Thumbnail (profile card) + Full (analysis page) */}
            <div style={{ display: 'flex', gap: 40, justifyContent: 'center', alignItems: 'flex-start', flexWrap: 'wrap' }}>

              {/* Thumbnail — as it appears on the profile card */}
              <div style={{ textAlign: 'center' }}>
                <div style={{ color: textMuted, fontSize: 12, marginBottom: 12, fontWeight: 500, letterSpacing: '0.05em', textTransform: 'uppercase' }}>
                  Profile Card (scale 0.55)
                </div>
                <div style={{
                  width: 100, height: 100, overflow: 'hidden', borderRadius: 12,
                  background: darkMode ? 'rgba(3,7,18,0.4)' : 'rgba(255,255,255,0.5)',
                  display: 'flex', alignItems: 'center', justifyContent: 'center',
                  border: `1px solid ${borderColor}`,
                }}>
                  <div style={{ transform: 'scale(0.55)', transformOrigin: 'center center' }}>
                    <AuraVisualization stage={stage} darkMode={darkMode} />
                  </div>
                </div>
              </div>

              {/* Full — as it appears on the analysis page */}
              <div style={{ textAlign: 'center' }}>
                <div style={{ color: textMuted, fontSize: 12, marginBottom: 12, fontWeight: 500, letterSpacing: '0.05em', textTransform: 'uppercase' }}>
                  Analysis Page (full size)
                </div>
                <div style={{
                  borderRadius: 16, overflow: 'hidden', padding: 12,
                  background: darkMode ? 'rgba(17,24,39,0.5)' : 'rgba(243,244,246,0.5)',
                  border: `1px solid ${borderColor}`,
                }}>
                  <AuraVisualization stage={stage} darkMode={darkMode} />
                </div>
              </div>

              {/* Phone frame preview */}
              <div style={{ textAlign: 'center' }}>
                <div style={{ color: textMuted, fontSize: 12, marginBottom: 12, fontWeight: 500, letterSpacing: '0.05em', textTransform: 'uppercase' }}>
                  In Phone Frame
                </div>
                <div style={{
                  width: 280 + 16, height: 607 + 16,
                  borderRadius: 40, padding: 8,
                  background: 'linear-gradient(145deg, #2a2a2e, #1a1a1c)',
                  boxShadow: 'inset 0 1px 0 rgba(255,255,255,0.06), 0 0 0 1px rgba(0,0,0,0.3), 0 20px 60px rgba(0,0,0,0.5)',
                  flexShrink: 0,
                }}>
                  <div style={{
                    width: 280, height: 607,
                    borderRadius: 33, overflow: 'hidden',
                    background: darkMode ? '#030712' : '#f9fafb',
                    display: 'flex', flexDirection: 'column',
                    transition: 'background 0.4s ease',
                  }}>
                    {/* Dynamic Island */}
                    <div style={{ display: 'flex', justifyContent: 'center', paddingTop: 8 }}>
                      <div style={{
                        width: 90, height: 26, borderRadius: 20,
                        background: '#000',
                      }} />
                    </div>

                    {/* Status bar */}
                    <div style={{
                      display: 'flex', justifyContent: 'space-between', alignItems: 'center',
                      padding: '6px 20px 8px',
                      fontSize: 11, fontWeight: 600,
                      color: darkMode ? 'rgba(255,255,255,0.7)' : 'rgba(0,0,0,0.7)',
                    }}>
                      <span>9:41</span>
                      <span style={{ fontSize: 10 }}>●●● ▲ ■</span>
                    </div>

                    {/* Header */}
                    <div style={{
                      display: 'flex', alignItems: 'center', padding: '4px 16px 8px',
                    }}>
                      <span style={{ color: darkMode ? '#6b7280' : '#9ca3af', fontSize: 16 }}>←</span>
                      <span style={{ flex: 1, textAlign: 'center', fontWeight: 500, fontSize: 14, color: darkMode ? '#f9fafb' : '#111827' }}>Analysis</span>
                      <div style={{ width: 16 }} />
                    </div>

                    {/* Aura viz */}
                    <div style={{
                      borderRadius: 12, overflow: 'hidden', margin: '0 12px',
                      background: darkMode ? 'rgba(17,24,39,0.3)' : 'rgba(243,244,246,0.5)',
                    }}>
                      <AuraVisualization stage={stage} darkMode={darkMode} />
                    </div>

                    {/* Mock content below */}
                    <div style={{ padding: '12px 16px', flex: 1 }}>
                      <div style={{
                        fontSize: 13, fontWeight: 600, textAlign: 'center',
                        background: 'linear-gradient(135deg, #8b5cf6, #d946ef, #06b6d4)',
                        WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent',
                        marginBottom: 12,
                      }}>
                        {stage >= 3 ? 'Composed Innovator' : stage >= 2 ? 'Emerging Pattern' : 'Early Signal'}
                      </div>

                      {/* Mock trait bars */}
                      {[
                        { label: 'Curious', color: '#8b5cf6', pct: 78 },
                        { label: 'Empathetic', color: '#10b981', pct: 85 },
                        { label: 'Outgoing', color: '#d946ef', pct: 65 },
                      ].slice(0, Math.min(stage + 1, 3)).map((t, i) => (
                        <div key={i} style={{ marginBottom: 10 }}>
                          <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: 10, color: darkMode ? '#9ca3af' : '#6b7280', marginBottom: 3 }}>
                            <span>{t.label}</span>
                            <span>{t.pct}%</span>
                          </div>
                          <div style={{ height: 4, borderRadius: 2, background: darkMode ? 'rgba(255,255,255,0.06)' : 'rgba(0,0,0,0.06)', position: 'relative' }}>
                            <div style={{
                              height: '100%', borderRadius: 2, width: `${t.pct}%`,
                              background: `linear-gradient(90deg, ${hexToRgba(t.color, 0.3)}, ${t.color})`,
                            }} />
                            <div style={{
                              position: 'absolute', top: '50%', left: `${t.pct}%`,
                              width: 10, height: 10, borderRadius: '50%',
                              background: t.color, border: `2px solid ${darkMode ? '#030712' : '#f9fafb'}`,
                              transform: 'translate(-50%, -50%)',
                              boxShadow: `0 0 6px ${hexToRgba(t.color, 0.5)}`,
                            }} />
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                </div>
              </div>

            </div>

            {/* Integration notes */}
            <div style={{
              marginTop: 40, padding: 20, borderRadius: 12,
              background: darkMode ? 'rgba(255,255,255,0.03)' : 'rgba(0,0,0,0.03)',
              border: `1px solid ${borderColor}`,
              color: textMuted, fontSize: 13, lineHeight: 1.6,
            }}>
              <strong style={{ color: textPrimary }}>Integration:</strong> Copy the AuraVisualization component
              (lines marked with the component) to replace the existing one in index.html (~line 1311-1456).
              Same props interface: {'{ stage, darkMode }'}. Uses existing COLOR_HEX tokens.
              Adds CSS keyframes (aura-breathe, star-twinkle) to the style block.
            </div>
          </div>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
